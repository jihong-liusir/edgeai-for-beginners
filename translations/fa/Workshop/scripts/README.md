<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "8344ea4f8f563cfa921e09247588a225",
  "translation_date": "2025-10-08T21:59:21+00:00",
  "source_file": "Workshop/scripts/README.md",
  "language_code": "fa"
}
-->
# اسکریپت‌های کارگاه

این پوشه شامل اسکریپت‌های خودکارسازی و پشتیبانی است که برای حفظ کیفیت و هماهنگی در مواد کارگاه استفاده می‌شوند.

## محتوا

| فایل | هدف |
|------|---------|
| `lint_markdown_cli.py` | بررسی کدهای محصور شده در بلوک‌های کد مارک‌داون برای جلوگیری از استفاده از الگوهای دستورات قدیمی Foundry Local CLI. |
| `export_benchmark_markdown.py` | اجرای بنچمارک تأخیر چند مدل و تولید گزارش‌های مارک‌داون + JSON. |

## 1. بررسی‌کننده الگوی CLI مارک‌داون

`lint_markdown_cli.py` تمام فایل‌های `.md` غیرترجمه‌ای را برای الگوهای Foundry Local CLI غیرمجاز **در داخل بلوک‌های کد محصور شده** (``` ... ```) اسکن می‌کند. متن‌های توضیحی همچنان می‌توانند دستورات قدیمی را برای زمینه تاریخی ذکر کنند.

### الگوهای قدیمی (مسدود شده در داخل بلوک‌های کد)

بررسی‌کننده الگوهای CLI قدیمی را مسدود می‌کند. به جای آن‌ها از جایگزین‌های مدرن استفاده کنید.

### جایگزین‌های مورد نیاز
| قدیمی | به جای آن استفاده کنید |
|------------|-------------|
| `foundry model chat <a> "..."` | `foundry model run <a> --prompt "..."` |
| `foundry model list --running` | `foundry model list` |
| `foundry model list --cached` | `foundry cache list` |
| `foundry model stats` | اسکریپت بنچمارک + ابزارهای سیستمی (`Task Manager`, `nvidia-smi`) |
| `foundry model benchmark` | `samples/session03/benchmark_oss_models.py` |
| `foundry model list --available` | `foundry model list` |

### کدهای خروجی
| کد | معنی |
|------|---------|
| 0 | هیچ تخلفی شناسایی نشد |
| 1 | یک یا چند الگوی قدیمی یافت شد |

### اجرای محلی
از ریشه مخزن (توصیه‌شده):

ویندوز (PowerShell):
```powershell
python Workshop\scripts\lint_markdown_cli.py --verbose
```

macOS / لینوکس:
```bash
python Workshop/scripts/lint_markdown_cli.py --verbose
```

### قلاب پیش از کامیت (اختیاری)
```bash
echo "python Workshop/scripts/lint_markdown_cli.py" > .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```
 این کار از کامیت‌هایی که الگوهای قدیمی را معرفی می‌کنند جلوگیری می‌کند.

### یکپارچه‌سازی CI
یک گردش کار GitHub Action (`.github/workflows/markdown-cli-lint.yml`) بررسی‌کننده را در هر push و pull request به شاخه‌های `main` و `Reactor` اجرا می‌کند. کارهای ناموفق باید قبل از ادغام اصلاح شوند.

### افزودن الگوهای قدیمی جدید
1. فایل `lint_markdown_cli.py` را باز کنید.
2. یک جفت `(regex, suggestion)` به لیست `DEPRECATED` اضافه کنید. از یک رشته خام استفاده کنید و در صورت لزوم مرزهای کلمه `\b` را شامل کنید.
3. بررسی‌کننده را به صورت محلی اجرا کنید تا از شناسایی اطمینان حاصل کنید.
4. کامیت و push کنید؛ CI قانون جدید را اعمال خواهد کرد.

مثال اضافه کردن:
```python
DEPRECATED.append((r"\\bfoundry\\s+experimental\\s+foo\\b", "Remove experimental foo usage"))
```

### اجازه به ذکر توضیحی
از آنجا که فقط بلوک‌های کد محصور شده اعمال می‌شوند، می‌توانید دستورات قدیمی را در متن توضیحی به‌طور ایمن توصیف کنید. اگر *باید* آن‌ها را در یک بلوک نشان دهید، از بلوک محصور شده **بدون** سه علامت بک‌تیک (مثلاً با تورفتگی یا نقل قول) استفاده کنید یا به صورت شبه‌فرم بازنویسی کنید.

### نادیده گرفتن فایل‌های خاص (پیشرفته)
در صورت نیاز، مثال‌های قدیمی را در یک فایل جداگانه خارج از مخزن قرار دهید یا هنگام پیش‌نویس با یک پسوند متفاوت تغییر نام دهید. نادیده‌گیری‌های عمدی برای نسخه‌های ترجمه‌شده به‌طور خودکار انجام می‌شود (مسیرهایی که شامل `translations` هستند).

### رفع اشکال
| مشکل | علت | راه‌حل |
|-------|-------|-----------|
| بررسی‌کننده خطی که به‌روزرسانی کرده‌اید را علامت‌گذاری می‌کند | Regex بیش از حد گسترده است | الگو را با مرز کلمه اضافی (`\b`) یا لنگرها محدود کنید |
| CI شکست می‌خورد اما محلی موفق است | نسخه متفاوت Python یا تغییرات ذخیره‌نشده | به صورت محلی دوباره اجرا کنید، مطمئن شوید که درخت کاری تمیز است، نسخه Python گردش کار (3.11) را بررسی کنید |
| نیاز به دور زدن موقت | رفع فوری مشکل | بلافاصله پس از آن مشکل را رفع کنید؛ در نظر بگیرید از یک شاخه موقت و PR پیگیری استفاده کنید (از افزودن سوئیچ‌های دور زدن خودداری کنید) |

### دلیل
هماهنگ نگه داشتن مستندات با سطح CLI پایدار *فعلی* از اصطکاک در کارگاه جلوگیری می‌کند، از سردرگمی یادگیرندگان اجتناب می‌کند و اندازه‌گیری عملکرد را از طریق اسکریپت‌های پایتون نگهداری‌شده به جای دستورات CLI پراکنده متمرکز می‌کند.

---
به عنوان بخشی از زنجیره ابزار کیفیت کارگاه نگهداری می‌شود. برای بهبودها (مانند پیشنهادات خودکار یا تولید گزارش HTML)، یک issue باز کنید یا یک PR ارسال کنید.

## 2. اسکریپت اعتبارسنجی نمونه

`validate_samples.py` تمام فایل‌های نمونه پایتون را برای اعتبارسنجی نحو، واردات و رعایت بهترین شیوه‌ها بررسی می‌کند.

### استفاده
```bash
# Validate all samples
python scripts/validate_samples.py

# Validate specific session
python scripts/validate_samples.py --session 01

# Verbose mode (includes best practice warnings)
python scripts/validate_samples.py --verbose

# Summary only
python scripts/validate_samples.py --summary
```

### چه چیزی را بررسی می‌کند
- ✅ اعتبار نحو پایتون
- ✅ واردات‌های مورد نیاز موجود
- ✅ پیاده‌سازی مدیریت خطا (حالت توضیحی)
- ✅ استفاده از نوع‌گذاری (حالت توضیحی)
- ✅ توضیحات توابع (حالت توضیحی)
- ✅ لینک‌های مرجع SDK (حالت توضیحی)

### متغیرهای محیطی
- `SKIP_IMPORT_CHECK=1` - از بررسی واردات صرف‌نظر کنید
- `SKIP_SYNTAX_CHECK=1` - از بررسی نحو صرف‌نظر کنید

### کدهای خروجی
- `0` - تمام نمونه‌ها اعتبارسنجی را گذراندند
- `1` - یک یا چند نمونه ناموفق بودند

## 3. اسکریپت اجرای تست نمونه

`test_samples.py` تست‌های اولیه را روی تمام نمونه‌ها اجرا می‌کند تا اطمینان حاصل شود که بدون خطا اجرا می‌شوند.

### استفاده
```bash
# Test all samples
python scripts/test_samples.py

# Test specific session
python scripts/test_samples.py --session 01

# Quick mode (shorter timeouts)
python scripts/test_samples.py --quick

# Verbose mode (show output)
python scripts/test_samples.py --verbose
```

### پیش‌نیازها
- سرویس Foundry Local در حال اجرا: `foundry service start`
- مدل‌ها بارگذاری شده: `foundry model run phi-4-mini`
- وابستگی‌ها نصب شده: `pip install -r requirements.txt`

### چه چیزی را تست می‌کند
- ✅ نمونه می‌تواند بدون خطای زمان اجرا اجرا شود
- ✅ خروجی مورد نیاز تولید می‌شود
- ✅ مدیریت خطای مناسب در صورت شکست
- ✅ عملکرد (زمان اجرا)

### متغیرهای محیطی
- `FOUNDRY_LOCAL_ALIAS=phi-4-mini` - مدلی که برای تست استفاده می‌شود
- `TEST_TIMEOUT=30` - زمان محدود برای هر نمونه به ثانیه

### شکست‌های مورد انتظار
برخی از تست‌ها ممکن است در صورت نصب نشدن وابستگی‌های اختیاری (مانند `ragas`, `sentence-transformers`) شکست بخورند. نصب با:
```bash
pip install sentence-transformers ragas datasets
```

### کدهای خروجی
- `0` - تمام تست‌ها موفق بودند
- `1` - یک یا چند تست ناموفق بودند

## 4. صادرکننده بنچمارک مارک‌داون

اسکریپت: `export_benchmark_markdown.py`

جدول عملکرد قابل بازتولید برای مجموعه‌ای از مدل‌ها تولید می‌کند.

### استفاده
```powershell
python Workshop\scripts\export_benchmark_markdown.py --models "qwen2.5-0.5b,gemma-2-2b" --prompt "Explain retrieval augmented generation briefly." --rounds 3 --output benchmark_report.md
```

### خروجی‌ها
| فایل | توضیحات |
|------|-------------|
| `benchmark_report.md` | جدول مارک‌داون (میانگین، p95، توکن‌ها در ثانیه، توکن اول اختیاری) |
| `benchmark_report.json` | آرایه متریک‌های خام برای مقایسه و تاریخچه |

### گزینه‌ها
| پرچم | توضیحات | پیش‌فرض |
|------|-------------|---------|
| `--models` | نام مستعار مدل‌ها به صورت کاما جدا شده | (الزامی) |
| `--prompt` | پرامپت استفاده شده در هر دور | (الزامی) |
| `--rounds` | تعداد دورها برای هر مدل | 3 |
| `--output` | فایل خروجی مارک‌داون | `benchmark_report.md` |
| `--json` | فایل خروجی JSON | `benchmark_report.json` |
| `--fail-on-empty` | خروجی غیر صفر در صورت شکست تمام بنچمارک‌ها | خاموش |

متغیر محیطی `BENCH_STREAM=1` اندازه‌گیری تأخیر توکن اول را اضافه می‌کند.

### نکات
- از `workshop_utils` برای بوت‌استرپ و کش کردن مدل‌ها به صورت یکسان استفاده می‌کند.
- اگر از یک دایرکتوری کاری متفاوت اجرا شود، اسکریپت تلاش می‌کند مسیرهای جایگزین را برای یافتن `workshop_utils` پیدا کند.
- برای مقایسه GPU: یک بار اجرا کنید، شتاب‌دهی را از طریق تنظیمات CLI فعال کنید، دوباره اجرا کنید و JSON را مقایسه کنید.

---

**سلب مسئولیت**:  
این سند با استفاده از سرویس ترجمه هوش مصنوعی [Co-op Translator](https://github.com/Azure/co-op-translator) ترجمه شده است. در حالی که ما تلاش می‌کنیم دقت را حفظ کنیم، لطفاً توجه داشته باشید که ترجمه‌های خودکار ممکن است شامل خطاها یا نادرستی‌ها باشند. سند اصلی به زبان اصلی آن باید به عنوان منبع معتبر در نظر گرفته شود. برای اطلاعات حساس، توصیه می‌شود از ترجمه حرفه‌ای انسانی استفاده کنید. ما مسئولیتی در قبال سوء تفاهم‌ها یا تفسیرهای نادرست ناشی از استفاده از این ترجمه نداریم.