<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "382a763fcea7087e68a94c26216e5e70",
  "translation_date": "2025-09-22T17:40:57+00:00",
  "source_file": "Module08/05.AIPoweredAgents.md",
  "language_code": "bn"
}
-->
# সেশন ৫: Foundry Local দিয়ে দ্রুত AI-চালিত এজেন্ট তৈরি করুন

Note: Foundry Local-এ এজেন্টের সক্ষমতা পরিবর্তিত হয়—উন্নত প্যাটার্ন প্রয়োগের আগে সর্বশেষ রিলিজ নোটে সমর্থন নিশ্চিত করুন।

## সংক্ষিপ্ত বিবরণ

Foundry Local ব্যবহার করে এজেন্টিক অ্যাপ্লিকেশন দ্রুত প্রোটোটাইপ করুন: সিস্টেম প্রম্পট, গ্রাউন্ডিং, এবং অর্কেস্ট্রেশন প্যাটার্ন। যখন এজেন্ট সমর্থন উপলব্ধ থাকে, তখন OpenAI-সামঞ্জস্যপূর্ণ ফাংশন কলিংয়ে মানকরণ করতে পারেন অথবা হাইব্রিড ডিজাইনে ক্লাউড সাইডে Azure AI Agents ব্যবহার করতে পারেন।

রেফারেন্স:
- Foundry Local ডকস: https://learn.microsoft.com/en-us/azure/ai-foundry/foundry-local/
- Azure AI Foundry Agents: https://learn.microsoft.com/en-us/azure/ai-services/agents/overview
- ফাংশন কলিং নমুনা (Foundry Local নমুনা): https://github.com/microsoft/Foundry-Local/tree/main/samples/python/functioncalling

## শেখার লক্ষ্য
- নির্ভরযোগ্য আচরণের জন্য সিস্টেম প্রম্পট এবং গ্রাউন্ডিং কৌশল ডিজাইন করুন
- ফাংশন কলিং (টুল ব্যবহার) প্যাটার্ন প্রয়োগ করুন
- মাল্টি-এজেন্ট ওয়ার্কফ্লো অর্কেস্ট্রেট করুন (লোকাল এবং হাইব্রিড)
- পর্যবেক্ষণযোগ্যতা এবং নিরাপত্তার পরিকল্পনা করুন

## অংশ ১: সিস্টেম প্রম্পট এবং গ্রাউন্ডিং

- কঠোর ভূমিকা, সীমাবদ্ধতা, এবং আউটপুট স্কিমা সংজ্ঞায়িত করুন
- লোকাল বা এন্টারপ্রাইজ ডেটা দিয়ে রেসপন্স গ্রাউন্ড করুন
- ডাউনস্ট্রিম অটোমেশনের জন্য JSON আউটপুট প্রয়োগ করুন

## অংশ ২: ফাংশন কলিং (OpenAI-সামঞ্জস্যপূর্ণ)

```python
# tools.py
import json

def get_weather(city: str) -> str:
    return f"Weather in {city}: Sunny, 25C"

FUNCTIONS = [
    {
        "name": "get_weather",
        "description": "Get current weather for a city",
        "parameters": {
            "type": "object",
            "properties": {
                "city": {"type": "string", "description": "City name"}
            },
            "required": ["city"]
        }
    }
]
```

```python
# agent.py
import requests
import json
from tools import FUNCTIONS, get_weather

BASE_URL = "http://localhost:8000"
MODEL = "phi-4-mini"

SYSTEM_PROMPT = "You are a helpful assistant. Use tools when needed."

def call_model(messages, functions=None):
    payload = {
        "model": MODEL,
        "messages": messages,
        "functions": functions,
        "function_call": "auto"
    }
    r = requests.post(f"{BASE_URL}/v1/chat/completions", json=payload, timeout=60)
    r.raise_for_status()
    return r.json()

messages = [{"role": "system", "content": SYSTEM_PROMPT},
            {"role": "user", "content": "What's the weather in Paris?"}]

resp = call_model(messages, functions=FUNCTIONS)
choice = resp["choices"][0]["message"]

if "function_call" in choice:
    fc = choice["function_call"]
    if fc["name"] == "get_weather":
        args = json.loads(fc["arguments"])
        result = get_weather(args["city"])
        messages.append(choice)
        messages.append({"role": "function", "name": "get_weather", "content": result})
        final = call_model(messages)
        print(final["choices"][0]["message"]["content"]) 
else:
    print(choice.get("content"))
```

চালান:
```powershell
# Ensure a model is running
foundry model run phi-4-mini
python agent.py
```


## অংশ ৩: মাল্টি-এজেন্ট অর্কেস্ট্রেশন (প্যাটার্ন)

Foundry Local-এর OpenAI-সামঞ্জস্যপূর্ণ এন্ডপয়েন্ট ব্যবহার করে টাস্কগুলো বিশেষজ্ঞ এজেন্টদের (রিট্রিভাল, রিজনিং, এক্সিকিউশন) কাছে রাউট করার জন্য একটি কোঅর্ডিনেটর ডিজাইন করুন।

ধাপ ১) বিশেষজ্ঞ এজেন্ট সংজ্ঞায়িত করুন
```python
# agents/specialists.py
import requests
BASE_URL = "http://localhost:8000"
MODEL = "phi-4-mini"

headers = {"Content-Type": "application/json", "Authorization": "Bearer local-key"}

def chat(messages, max_tokens=300, temperature=0.4):
    r = requests.post(f"{BASE_URL}/v1/chat/completions", json={
        "model": MODEL,
        "messages": messages,
        "max_tokens": max_tokens,
        "temperature": temperature
    }, headers=headers, timeout=60)
    r.raise_for_status()
    return r.json()["choices"][0]["message"]["content"]

class RetrievalAgent:
    SYSTEM = "You retrieve relevant snippets from knowledge sources based on a query."
    def run(self, query: str) -> str:
        # Placeholder: in real use, fetch from local files or vector DB
        messages = [{"role": "system", "content": self.SYSTEM},
                    {"role": "user", "content": f"Retrieve key facts for: {query}"}]
        return chat(messages)

class ReasoningAgent:
    SYSTEM = "You analyze inputs step by step and produce structured conclusions."
    def run(self, context: str, question: str) -> str:
        messages = [
            {"role": "system", "content": self.SYSTEM},
            {"role": "user", "content": f"Context:\n{context}\n\nQuestion: {question}\nThink step-by-step and produce a concise answer."}
        ]
        return chat(messages)

class ExecutionAgent:
    SYSTEM = "You transform decisions into actionable steps (JSON with actions)."
    def run(self, decision: str) -> str:
        messages = [
            {"role": "system", "content": self.SYSTEM},
            {"role": "user", "content": f"Turn this decision into 3 executable steps as JSON:\n{decision}"}
        ]
        return chat(messages)
```

ধাপ ২) কোঅর্ডিনেটর তৈরি করুন
```python
# agents/coordinator.py
from agents.specialists import RetrievalAgent, ReasoningAgent, ExecutionAgent

class Coordinator:
    def __init__(self):
        self.retrieval = RetrievalAgent()
        self.reasoning = ReasoningAgent()
        self.execution = ExecutionAgent()

    def handle(self, user_goal: str) -> dict:
        # 1. Retrieve context
        context = self.retrieval.run(user_goal)
        # 2. Reason on context
        decision = self.reasoning.run(context, user_goal)
        # 3. Produce actionable steps
        actions = self.execution.run(decision)
        return {
            "goal": user_goal,
            "context": context,
            "decision": decision,
            "actions": actions
        }

if __name__ == "__main__":
    # Ensure: foundry model run phi-4-mini
    coord = Coordinator()
    result = coord.handle("Create a plan to onboard 5 new customers this month")
    print(result)
```

ধাপ ৩) Foundry Local-এর বিরুদ্ধে যাচাই করুন
```powershell
REM Confirm the local endpoint and model are available
foundry model list
foundry model run phi-4-mini
curl http://localhost:8000/v1/models

REM Run the coordinator
python -m samples.05.agents.coordinator
```


নির্দেশিকা:
- এজেন্টগুলোর মধ্যে পুনরায় চেষ্টা এবং টাইমআউট প্রয়োগ করুন
- কথোপকথন/থ্রেড স্টেটের জন্য একটি ছোট ইন-মেমরি স্টোর (dict) যোগ করুন
- একাধিক কল চেইন করার সময় রেট-লিমিটিং চালু করুন

## অংশ ৪: পর্যবেক্ষণযোগ্যতা এবং নিরাপত্তা

প্রম্পট, রেসপন্স, এবং ত্রুটি লোকালভাবে ট্র্যাক করুন, এজেন্ট স্ট্যাকে ডেটা হাইজিন প্রয়োগ করুন।

ধাপ ১) হালকা রিকোয়েস্ট লগিং (ঐচ্ছিক)

Note: নিম্নলিখিত হেল্পার ডিফল্টভাবে অন্তর্ভুক্ত নয়। যদি আপনি পরীক্ষার জন্য লোকাল JSON লগিং চান, তাহলে `infra/obs.py` তৈরি করুন।
```python
# infra/obs.py
import time, json, os
from datetime import datetime

LOG_DIR = os.getenv("FOUNDRY_AGENT_LOG_DIR", "./agent_logs")
os.makedirs(LOG_DIR, exist_ok=True)

def log_event(kind: str, payload: dict):
    ts = datetime.utcnow().strftime("%Y%m%dT%H%M%SZ")
    path = os.path.join(LOG_DIR, f"{ts}_{kind}.json")
    with open(path, "w", encoding="utf-8") as f:
        json.dump(payload, f, ensure_ascii=False, indent=2)
```

এজেন্টে লগিং ইন্টিগ্রেট করুন (ঐচ্ছিক):
```python
# in agents/specialists.py after receiving content
from infra.obs import log_event
# ... inside chat(...)
resp = r.json()
log_event("chat_request", {"endpoint": f"{BASE_URL}/v1/chat/completions"})
log_event("chat_response", resp)
return resp["choices"][0]["message"]["content"]
```


ধাপ ২) CLI দিয়ে উপলব্ধতা এবং মৌলিক স্বাস্থ্য যাচাই করুন
```powershell
REM Ensure Foundry Local is running a model
foundry model list
foundry model run phi-4-mini

REM Validate the OpenAI-compatible endpoint
curl http://localhost:8000/v1/models
```


ধাপ ৩) রেডাকশন এবং PII হাইজিন
- মডেলে বার্তা পাঠানোর আগে সংবেদনশীল ক্ষেত্রগুলো (ইমেইল, ফোন নম্বর, আইডি) মুছে ফেলুন বা হ্যাশ করুন
- কাঁচা সোর্স ডেটা ডিভাইসে রাখুন, শুধুমাত্র প্রয়োজনীয় কনটেক্সট স্ট্রিং পাঠান

রেডাকশন হেল্পারের উদাহরণ:
```python
# infra/redact.py
import re
EMAIL_RE = re.compile(r"[\w\.-]+@[\w\.-]+")
PHONE_RE = re.compile(r"\+?\d[\d\s\-]{7,}\d")

def sanitize(text: str) -> str:
    text = EMAIL_RE.sub("[REDACTED_EMAIL]", text)
    text = PHONE_RE.sub("[REDACTED_PHONE]", text)
    return text
```

এজেন্টে ব্যবহার করুন:
```python
from infra.redact import sanitize
# user_goal = sanitize(user_goal)
# context = sanitize(context)
```


ধাপ ৪) সার্কিট ব্রেকার এবং ত্রুটি পরিচালনা
- প্রতিটি এজেন্ট কল try/except এবং এক্সপোনেনশিয়াল ব্যাকঅফ দিয়ে মোড়ান
- বারবার ব্যর্থতার ক্ষেত্রে পাইপলাইন শর্ট-সার্কিট করুন

```python
import time

def with_retry(func, retries=3, base_delay=0.5):
    for i in range(retries):
        try:
            return func()
        except Exception as e:
            if i == retries - 1:
                raise
            time.sleep(base_delay * (2 ** i))
```


ধাপ ৫) লোকাল অডিট ট্রেইল এবং এক্সপোর্ট
- JSON লগগুলো `./agent_logs`-এ সংরক্ষণ করুন
- নিয়মিতভাবে লগগুলো কমপ্রেস এবং রোটেট করুন
- পর্যালোচনার জন্য সারাংশ এক্সপোর্ট করুন (গণনা, গড় লেটেন্সি, ত্রুটি হার)

ধাপ ৬) Microsoft Learn ডকসের সাথে ক্রস-চেক করুন
- Foundry Local একটি OpenAI-সামঞ্জস্যপূর্ণ API প্রদান করে (যাচাই করুন `curl /v1/models` দিয়ে)
- মডেলের উপলব্ধতা নিশ্চিত করতে `foundry model run <name>` ব্যবহার করুন
- ক্লায়েন্ট ইন্টিগ্রেশন এবং নমুনা অ্যাপের জন্য অফিসিয়াল নির্দেশিকা অনুসরণ করুন (Open WebUI/how-tos)

রেফারেন্স:
- Foundry Local (Learn): https://learn.microsoft.com/en-us/azure/ai-foundry/foundry-local/
- Open WebUI how-to: https://learn.microsoft.com/en-us/azure/ai-foundry/foundry-local/how-to/how-to-chat-application-with-open-web-ui
- ফাংশন কলিং নমুনা: https://github.com/microsoft/Foundry-Local/tree/main/samples/python/functioncalling

## পরবর্তী পদক্ষেপ
- ক্লাউড-হোস্টেড অর্কেস্ট্রেশনের জন্য Azure AI Agents অন্বেষণ করুন
- এন্টারপ্রাইজ কানেক্টর যোগ করুন (Microsoft Graph, Search, ডাটাবেস)

---

