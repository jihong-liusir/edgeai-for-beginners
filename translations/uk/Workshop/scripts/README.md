<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "8344ea4f8f563cfa921e09247588a225",
  "translation_date": "2025-10-08T12:22:28+00:00",
  "source_file": "Workshop/scripts/README.md",
  "language_code": "uk"
}
-->
# Скрипти для майстерні

Ця директорія містить автоматизаційні та допоміжні скрипти, які використовуються для підтримки якості та узгодженості матеріалів майстерні.

## Зміст

| Файл | Призначення |
|------|-------------|
| `lint_markdown_cli.py` | Перевіряє кодові блоки Markdown на застарілі шаблони команд Foundry Local CLI. |
| `export_benchmark_markdown.py` | Виконує багатомодельний тест продуктивності та створює звіти у форматах Markdown + JSON. |

## 1. Лінтер шаблонів Markdown CLI

`lint_markdown_cli.py` сканує всі `.md` файли, які не є перекладами, на заборонені шаблони команд Foundry Local CLI **всередині огороджених кодових блоків** (``` ... ```). Інформаційний текст все ще може згадувати застарілі команди для історичного контексту.

### Застарілі шаблони (заборонені всередині кодових блоків)

Лінтер блокує застарілі шаблони CLI. Використовуйте сучасні альтернативи.

### Необхідні заміни
| Застаріле | Використовуйте замість |
|-----------|------------------------|
| `foundry model chat <a> "..."` | `foundry model run <a> --prompt "..."` |
| `foundry model list --running` | `foundry model list` |
| `foundry model list --cached` | `foundry cache list` |
| `foundry model stats` | Скрипт для тестування продуктивності + системні інструменти (`Task Manager`, `nvidia-smi`) |
| `foundry model benchmark` | `samples/session03/benchmark_oss_models.py` |
| `foundry model list --available` | `foundry model list` |

### Коди виходу
| Код | Значення |
|-----|----------|
| 0 | Порушень не виявлено |
| 1 | Виявлено одне або більше порушень |

### Запуск локально
З кореня репозиторію (рекомендовано):

Windows (PowerShell):
```powershell
python Workshop\scripts\lint_markdown_cli.py --verbose
```

macOS / Linux:
```bash
python Workshop/scripts/lint_markdown_cli.py --verbose
```

### Хук перед комітом (опціонально)
```bash
echo "python Workshop/scripts/lint_markdown_cli.py" > .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```
Це блокує коміти, які вводять застарілі шаблони.

### Інтеграція з CI
GitHub Action workflow (`.github/workflows/markdown-cli-lint.yml`) запускає лінтер при кожному пуші та pull request до гілок `main` і `Reactor`. Завдання, які завершилися невдачею, необхідно виправити перед злиттям.

### Додавання нових застарілих шаблонів
1. Відкрийте `lint_markdown_cli.py`.
2. Додайте кортеж `(regex, suggestion)` до списку `DEPRECATED`. Використовуйте сирий рядок і включайте межі слова `\b`, де це доречно.
3. Запустіть лінтер локально, щоб перевірити виявлення.
4. Зробіть коміт і пуш; CI забезпечить виконання нового правила.

Приклад додавання:
```python
DEPRECATED.append((r"\\bfoundry\\s+experimental\\s+foo\\b", "Remove experimental foo usage"))
```

### Дозволені пояснювальні згадки
Оскільки перевіряються лише огороджені кодові блоки, ви можете безпечно описувати застарілі команди в тексті. Якщо вам *потрібно* показати їх у кодовому блоці для контрасту, додайте блок без потрійних бектіків (наприклад, через відступ або цитату) або перепишіть у псевдоформі.

### Пропуск конкретних файлів (просунуто)
За потреби, розміщуйте приклади з використанням застарілих шаблонів у окремому файлі поза репозиторієм або перейменовуйте з іншим розширенням під час розробки. Намірені пропуски для перекладених копій виконуються автоматично (шляхи, що містять `translations`).

### Вирішення проблем
| Проблема | Причина | Рішення |
|----------|---------|---------|
| Лінтер позначає рядок, який ви оновили | Regex занадто широкий | Звузьте шаблон, додавши межу слова (`\b`) або прив'язки |
| CI не проходить, але локально все працює | Різна версія Python або незбережені зміни | Перезапустіть локально, переконайтеся, що робоче дерево чисте, перевірте версію Python у workflow (3.11) |
| Потрібно тимчасово обійти | Екстрене виправлення | Застосуйте виправлення одразу після; розгляньте використання тимчасової гілки та наступного PR (уникайте додавання перемикачів обходу) |

### Обґрунтування
Підтримка документації у відповідності до *актуальної* стабільної CLI поверхні запобігає труднощам у майстерні, уникненню плутанини серед учасників і централізації вимірювання продуктивності через підтримувані Python-скрипти замість нестабільних CLI підкоманд.

---
Підтримується як частина інструментарію для забезпечення якості майстерні. Для покращень (наприклад, автоматичне виправлення пропозицій або генерація HTML-звітів) відкрийте issue або надішліть PR.

## 2. Скрипт перевірки зразків

`validate_samples.py` перевіряє всі файли зразків Python на синтаксис, імпорти та відповідність найкращим практикам.

### Використання
```bash
# Validate all samples
python scripts/validate_samples.py

# Validate specific session
python scripts/validate_samples.py --session 01

# Verbose mode (includes best practice warnings)
python scripts/validate_samples.py --verbose

# Summary only
python scripts/validate_samples.py --summary
```

### Що перевіряється
- ✅ Валідність синтаксису Python
- ✅ Наявність необхідних імпортів
- ✅ Реалізація обробки помилок (розширений режим)
- ✅ Використання типів (розширений режим)
- ✅ Докстрінги функцій (розширений режим)
- ✅ Посилання на SDK (розширений режим)

### Змінні середовища
- `SKIP_IMPORT_CHECK=1` - Пропустити перевірку імпортів
- `SKIP_SYNTAX_CHECK=1` - Пропустити перевірку синтаксису

### Коди виходу
- `0` - Усі зразки пройшли перевірку
- `1` - Один або більше зразків не пройшли перевірку

## 3. Тестувальник зразків

`test_samples.py` виконує тестування всіх зразків, щоб перевірити їх виконання без помилок.

### Використання
```bash
# Test all samples
python scripts/test_samples.py

# Test specific session
python scripts/test_samples.py --session 01

# Quick mode (shorter timeouts)
python scripts/test_samples.py --quick

# Verbose mode (show output)
python scripts/test_samples.py --verbose
```

### Передумови
- Запущена служба Foundry Local: `foundry service start`
- Завантажені моделі: `foundry model run phi-4-mini`
- Встановлені залежності: `pip install -r requirements.txt`

### Що тестується
- ✅ Зразок виконується без помилок під час виконання
- ✅ Генерується необхідний вихідний результат
- ✅ Коректна обробка помилок у разі невдачі
- ✅ Продуктивність (час виконання)

### Змінні середовища
- `FOUNDRY_LOCAL_ALIAS=phi-4-mini` - Модель для тестування
- `TEST_TIMEOUT=30` - Тайм-аут для кожного зразка в секундах

### Очікувані невдачі
Деякі тести можуть не пройти, якщо не встановлені опціональні залежності (наприклад, `ragas`, `sentence-transformers`). Встановіть за допомогою:
```bash
pip install sentence-transformers ragas datasets
```

### Коди виходу
- `0` - Усі тести пройшли успішно
- `1` - Один або більше тестів не пройшли

## 4. Експортер тестів продуктивності у Markdown

Скрипт: `export_benchmark_markdown.py`

Генерує відтворювану таблицю продуктивності для набору моделей.

### Використання
```powershell
python Workshop\scripts\export_benchmark_markdown.py --models "qwen2.5-0.5b,gemma-2-2b" --prompt "Explain retrieval augmented generation briefly." --rounds 3 --output benchmark_report.md
```

### Вихідні файли
| Файл | Опис |
|------|------|
| `benchmark_report.md` | Таблиця у форматі Markdown (середнє значення, p95, токени/сек, опціонально перший токен) |
| `benchmark_report.json` | Масив сирих метрик для порівняння та історії |

### Опції
| Прапорець | Опис | Значення за замовчуванням |
|----------|------|---------------------------|
| `--models` | Список псевдонімів моделей через кому | (обов'язково) |
| `--prompt` | Підказка, що використовується кожного раунду | (обов'язково) |
| `--rounds` | Кількість раундів на модель | 3 |
| `--output` | Файл вихідного Markdown | `benchmark_report.md` |
| `--json` | Файл вихідного JSON | `benchmark_report.json` |
| `--fail-on-empty` | Нульовий вихідний код, якщо всі тести продуктивності не вдалися | вимкнено |

Змінна середовища `BENCH_STREAM=1` додає вимірювання затримки першого токена.

### Примітки
- Використовує `workshop_utils` для узгодженого завантаження моделей і кешування.
- Якщо запуск здійснюється з іншої робочої директорії, скрипт намагається знайти `workshop_utils` через резервні шляхи.
- Для порівняння GPU: запустіть один раз, увімкніть прискорення через конфігурацію CLI, повторно запустіть і порівняйте JSON.

---

**Відмова від відповідальності**:  
Цей документ був перекладений за допомогою сервісу автоматичного перекладу [Co-op Translator](https://github.com/Azure/co-op-translator). Хоча ми прагнемо до точності, будь ласка, майте на увазі, що автоматичні переклади можуть містити помилки або неточності. Оригінальний документ на його рідній мові слід вважати авторитетним джерелом. Для критичної інформації рекомендується професійний людський переклад. Ми не несемо відповідальності за будь-які непорозуміння або неправильні тлумачення, що виникають внаслідок використання цього перекладу.