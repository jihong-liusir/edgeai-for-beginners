<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "ad0c054ebd3de404d997d1707a513c70",
  "translation_date": "2025-09-17T23:55:40+00:00",
  "source_file": "Module05/04.SLMOps.Deployment.md",
  "language_code": "pa"
}
-->
# ри╕рйИриХри╕ри╝рии 4: рибри┐рикри▓рйМриЗриорйИриВриЯ - рикрйНри░рйЛрибриХри╕ри╝рии-ри░рйЗрибрйА риори╛рибри▓ риЗрй░рикри▓рйАриорйИриВриЯрйЗри╕ри╝рии

## риУри╡ри░ри╡ри┐риК

риЗри╣ ри╡ри┐ри╕ридрйНри░ри┐рид риЯри┐риКриЯрйЛри░ри┐риЕри▓ ридрйБри╣ри╛риирйВрй░ Foundry Local рижрйА ри╡ри░ридрйЛриВ риХри░риХрйЗ рилри╛риИрии-риЯри┐риКрии риХрйАридрйЗ риХри╡ри╛риВриЯри╛риИриЬри╝риб риори╛рибри▓ри╛риВ риирйВрй░ рибри┐рикри▓рйМриЗ риХри░рии рижрйА рикрйВри░рйА рикрйНри░риХри┐ри░ри┐риЖ ри╡ри┐рй▒риЪ риорижриж риХри░рйЗриЧри╛ред риЕри╕рйАриВ риори╛рибри▓ риХриири╡ри░риЬри╝рии, риХри╡ри╛риВриЯри╛риИриЬри╝рйЗри╕ри╝рии риУрикриЯрйАриори╛риИриЬри╝рйЗри╕ри╝рии, риЕридрйЗ рибри┐рикри▓рйМриЗриорйИриВриЯ риХриирилри┐риЧри░рйЗри╕ри╝рии риирйВрй░ ри╕ри╝рйБри░рйВ ридрйЛриВ риЕрй░рид ридрй▒риХ риХри╡ри░ риХри░ри╛риВриЧрйЗред

## рикрйВри░ри╡ ри╕ри╝ри░ридри╛риВ

ри╕ри╝рйБри░рйВ риХри░рии ридрйЛриВ рикри╣ри┐ри▓ри╛риВ, риЗри╣ риприХрйАриирйА римригри╛риУ риХри┐ ридрйБри╣ри╛рибрйЗ риХрйЛри▓ ри╣рйЗриа ри▓ри┐риЦрйАриЖриВ риЪрйАриЬри╝ри╛риВ ри╣рии:

- тЬЕ рибри┐рикри▓рйМриЗриорйИриВриЯ ри▓риИ ридри┐риЖри░ риЗрй▒риХ рилри╛риИрии-риЯри┐риКрии риХрйАридри╛ onnx риори╛рибри▓
- тЬЕ Windows риЬри╛риВ Mac риХрй░рикри┐риКриЯри░
- тЬЕ Python 3.10 риЬри╛риВ риЗри╕ ридрйЛриВ риЙрй▒риЪри╛ ри╡ри░риЬрии
- тЬЕ риШрй▒риЯрйЛ-риШрй▒риЯ 8GB риЙрикри▓римриз RAM
- тЬЕ Foundry Local ридрйБри╣ри╛рибрйЗ ри╕ри┐ри╕риЯрио 'ридрйЗ риЗрй░ри╕риЯри╛ри▓ ри╣рйИ

## ринри╛риЧ 1: ри╡ри╛ридри╛ри╡ри░риг ри╕рйИриЯриЕрик

### ри▓рйЛрйЬрйАриВрижрйЗ риЯрйВри▓ риЗрй░ри╕риЯри╛ри▓ риХри░риири╛

риЖрикригрйЗ риЯри░риорйАриири▓ (Windows 'ридрйЗ Command Prompt, Mac 'ридрйЗ Terminal) риЦрйЛри▓рйНри╣рйЛ риЕридрйЗ ри╣рйЗриари╛риВ рижри┐рй▒ридрйЗ риХриори╛риВрибри╛риВ риирйВрй░ ри▓риЧри╛ридри╛ри░ риЪри▓ри╛риУ:

```bash
# Update transformers library to the latest version
pip install transformers -U

# Install Microsoft Olive (model conversion tool)
pip install git+https://github.com/microsoft/Olive.git

# Install ONNX Runtime GenAI
git clone https://github.com/microsoft/onnxruntime-genai
cd onnxruntime-genai && python build.py --config Release
pip install {Your build release path}/onnxruntime_genai-0.9.0.dev0-cp311-cp311-linux_x86_64.whl

# Install additional dependencies
pip install onnx onnxruntime numpy
```

тЪая╕П **риори╣рй▒ридри╡рикрйВри░рии риирйЛриЯ**: ридрйБри╣ри╛риирйВрй░ CMake ри╡ри░риЬрии 3.31 риЬри╛риВ риЗри╕ ридрйЛриВ риири╡ри╛риВ ри╡рйА ри▓рйЛрйЬрйАриВрижри╛ ри╣рйЛри╡рйЗриЧри╛, риЬри┐ри╕риирйВрй░ [cmake.org](https://cmake.org/download/) ридрйЛриВ рибри╛риКриири▓рйЛриб риХрйАридри╛ риЬри╛ ри╕риХрижри╛ ри╣рйИред

## ринри╛риЧ 2: риори╛рибри▓ риХриири╡ри░риЬри╝рии риЕридрйЗ риХри╡ри╛риВриЯри╛риИриЬри╝рйЗри╕ри╝рии

### ри╕ри╣рйА рилри╛ри░риорйИриЯ риЪрйБригриири╛

рилри╛риИрии-риЯри┐риКрии риХрйАридрйЗ риЫрйЛриЯрйЗ ринри╛ри╕ри╝ри╛ риори╛рибри▓ри╛риВ ри▓риИ, риЕри╕рйАриВ **ONNX рилри╛ри░риорйИриЯ** рижрйА ри╕ри┐рилри╛ри░ри╕ри╝ риХри░рижрйЗ ри╣ри╛риВ риХри┐риЙриВриХри┐ риЗри╣ рикрйНри░рижри╛рии риХри░рижри╛ ри╣рйИ:

- ЁЯЪА римри┐ри╣ридри░ рикрйНри░рижри░ри╕ри╝рии риУрикриЯрйАриори╛риИриЬри╝рйЗри╕ри╝рии
- ЁЯФз ри╣ри╛ри░рибри╡рйЗриЕри░-риЕриЧриирйЛри╕риЯри┐риХ рибри┐рикри▓рйМриЗриорйИриВриЯ
- ЁЯПн рикрйНри░рйЛрибриХри╕ри╝рии-ри░рйЗрибрйА ри╕риори░рй▒риери╛
- ЁЯУ▒ риХрйНри░ри╛ри╕-рикри▓рйЗриЯрилри╛ри░рио риЕриирйБриХрйВри▓ридри╛

### ри╡ри┐ризрйА 1: риЗрй▒риХ-риХриори╛риВриб риХриири╡ри░риЬри╝рии (ри╕ри┐рилри╛ри░ри╕ри╝ риХрйАридрйА риЧриИ)

риЖрикригрйЗ рилри╛риИрии-риЯри┐риКрии риори╛рибри▓ риирйВрй░ ри╕ри┐рй▒ризрйЗ риХриири╡ри░риЯ риХри░рии ри▓риИ ри╣рйЗриари╛риВ рижри┐рй▒ридрйА риХриори╛риВриб рижрйА ри╡ри░ридрйЛриВ риХри░рйЛ:

```bash
olive auto-opt \
    --model_name_or_path /path/to/your/finetuned/model \
    --device cpu \
    --provider CPUExecutionProvider \
    --use_model_builder \
    --precision int4 \
    --output_path models/your-model-name/onnx \
    --log_level 1
```

**рикрйИри░ри╛риорйАриЯри░ рижрйА ри╡ри┐риЖриЦри┐риЖ:**
- `--model_name_or_path`: ридрйБри╣ри╛рибрйЗ рилри╛риИрии-риЯри┐риКрии риори╛рибри▓ рижри╛ рикри╛рие
- `--device cpu`: риУрикриЯрйАриори╛риИриЬри╝рйЗри╕ри╝рии ри▓риИ CPU рижрйА ри╡ри░ридрйЛриВ риХри░рйЛ
- `--precision int4`: INT4 риХри╡ри╛риВриЯри╛риИриЬри╝рйЗри╕ри╝рии рижрйА ри╡ри░ридрйЛриВ риХри░рйЛ (ри▓риЧринриЧ 75% ри╕ри╛риИриЬри╝ риШриЯри╛риЙригри╛)
- `--output_path`: риХриири╡ри░риЯ риХрйАридрйЗ риори╛рибри▓ ри▓риИ риЖриЙриЯрикрйБрй▒риЯ рикри╛рие

### ри╡ри┐ризрйА 2: риХриирилри┐риЧри░рйЗри╕ри╝рии рилри╛риИри▓ рикри╣рйБрй░риЪ (риЕрибри╡ри╛риВри╕риб рипрйВриЬри╝ри░)

`finetuned_conversion_config.json` риири╛рио рижрйА риЗрй▒риХ риХриирилри┐риЧри░рйЗри╕ри╝рии рилри╛риИри▓ римригри╛риУ:

```json
{
    "input_model": {
        "type": "HfModel",
        "model_path": "/path/to/your/finetuned/model",
        "task": "text-generation"
    },
    "systems": {
        "local_system": {
            "type": "LocalSystem",
            "accelerators": [
                {
                    "execution_providers": [
                        "CPUExecutionProvider"
                    ]
                }
            ]
        }
    },
    "passes": {
        "builder": {
            "type": "ModelBuilder",
            "config": {
                "precision": "int4",
                "quantization_config": {
                    "block_size": 128,
                    "is_symmetric": false
                }
            }
        }
    },
    "host": "local_system",
    "target": "local_system",
    "cache_dir": "cache",
    "output_dir": "models/output/your-finetuned-model-onnx"
}
```

рилри┐ри░ риЪри▓ри╛риУ:

```bash
olive run --config ./finetuned_conversion_config.json
```

### риХри╡ри╛риВриЯри╛риИриЬри╝рйЗри╕ри╝рии ри╡ри┐риХри▓рикри╛риВ рижрйА ридрйБри▓риири╛

| рикрйНри░ри┐ри╕рйАри╕ри╝рии | рилри╛риИри▓ ри╕ри╛риИриЬри╝ | риЗрй░рилри░рйИриВри╕ ри╕рикрйАриб | риори╛рибри▓ риЧрйБригри╡рй▒ридри╛ | ри╕ри┐рилри╛ри░ри╕ри╝ риХрйАридрйА ри╡ри░ридрйЛриВ |
|-----------|-----------|-----------------|---------------|-----------------|
| FP16      | римрйЗри╕ри▓ри╛риИрии ├Ч 0.5 | ридрйЗриЬри╝ | ри╕рин ридрйЛриВ ри╡ризрйАриЖ | ри╣ри╛риИ-риРриВриб ри╣ри╛ри░рибри╡рйЗриЕри░ |
| INT8      | римрйЗри╕ри▓ри╛риИрии ├Ч 0.25 | римри╣рйБрид ридрйЗриЬри╝ | риЪрй░риЧри╛ | ри╕рй░ридрйБри▓ри┐рид риЪрйЛриг |
| INT4      | римрйЗри╕ри▓ри╛риИрии ├Ч 0.125 | ри╕рин ридрйЛриВ ридрйЗриЬри╝ | ри╕ри╡рйАриХри╛ри░рипрйЛриЧ | ри╕ри░рйЛрид-ри╕рйАриори┐рид |

ЁЯТб **ри╕ри┐рилри╛ри░ри╕ри╝**: риЖрикригрйЗ рикри╣ри┐ри▓рйЗ рибри┐рикри▓рйМриЗриорйИриВриЯ ри▓риИ INT4 риХри╡ри╛риВриЯри╛риИриЬри╝рйЗри╕ри╝рии риири╛ри▓ ри╕ри╝рйБри░рйВ риХри░рйЛред риЬрйЗ риЧрйБригри╡рй▒ридри╛ ри╕рй░ридрйБри╕ри╝риЯ риири╣рйАриВ ри╣рйИ, ридри╛риВ INT8 риЬри╛риВ FP16 рижрйА риХрйЛри╕ри╝ри┐ри╕ри╝ риХри░рйЛред

## ринри╛риЧ 3: Foundry Local рибри┐рикри▓рйМриЗриорйИриВриЯ риХриирилри┐риЧри░рйЗри╕ри╝рии

### риори╛рибри▓ риХриирилри┐риЧри░рйЗри╕ри╝рии римригри╛риЙригри╛

Foundry Local риори╛рибри▓ рибри╛риЗри░рйИриХриЯри░рйА ри╡ри┐рй▒риЪ риЬри╛риУ:

```bash
foundry cache cd ./models/
```

риЖрикригрйА риори╛рибри▓ рибри╛риЗри░рйИриХриЯри░рйА ри╕риЯрйНри░риХриЪри░ римригри╛риУ:

```bash
mkdir -p ./models/custom/your-finetuned-model
```

риЖрикригрйА риори╛рибри▓ рибри╛риЗри░рйИриХриЯри░рйА ри╡ри┐рй▒риЪ `inference_model.json` риХриирилри┐риЧри░рйЗри╕ри╝рии рилри╛риИри▓ римригри╛риУ:

```json
{
  "Name": "your-finetuned-model-int4",
  "Description": "Fine-tuned quantized model",
  "Version": "1.0",
  "PromptTemplate": {
    "system": "<|im_start|>system\n{Content}<|im_end|>",
    "user": "<|im_start|>user\n{Content}<|im_end|>",
    "assistant": "<|im_start|>assistant\n{Content}<|im_end|>",
    "prompt": "<|im_start|>user\n{Content}<|im_end|>\n<|im_start|>assistant"
  },
  "ModelConfig": {
    "max_length": 2048,
    "temperature": 0.7,
    "top_p": 0.9,
    "repetition_penalty": 1.1
  }
}
```

### риори╛рибри▓-ри╡ри┐ри╕ри╝рйЗри╕ри╝ риЯрйИриВрикри▓рйЗриЯ риХриирилри┐риЧри░рйЗри╕ри╝рии

#### Qwen ри╕рйАри░рйАриЬри╝ риори╛рибри▓ри╛риВ ри▓риИ:

```json
{
  "Name": "qwen-finetuned-int4",
  "PromptTemplate": {
    "system": "<|im_start|>system\n{Content}<|im_end|>",
    "user": "<|im_start|>user\n{Content}<|im_end|>",
    "assistant": "<|im_start|>assistant\n{Content}<|im_end|>",
    "prompt": "<|im_start|>user\n{Content}<|im_end|>\n<|im_start|>assistant"
  }
}
```

## ринри╛риЧ 4: риори╛рибри▓ риЯрйИри╕риЯри┐рй░риЧ риЕридрйЗ риУрикриЯрйАриори╛риИриЬри╝рйЗри╕ри╝рии

### риори╛рибри▓ риЗрй░ри╕риЯри╛ри▓рйЗри╕ри╝рии рижрйА рикрйБри╕ри╝риЯрйА риХри░риири╛

риЬри╛риВриЪрйЛ риХри┐ Foundry Local ридрйБри╣ри╛рибрйЗ риори╛рибри▓ риирйВрй░ рикриЫри╛риг ри╕риХрижри╛ ри╣рйИ:

```bash
foundry cache ls
```

ридрйБри╣ри╛риирйВрй░ ри╕рйВриЪрйА ри╡ри┐рй▒риЪ `your-finetuned-model-int4` рижри┐риЦри╛риИ рижрйЗригри╛ риЪри╛ри╣рйАрижри╛ ри╣рйИред

### риори╛рибри▓ риЯрйИри╕риЯри┐рй░риЧ ри╕ри╝рйБри░рйВ риХри░риири╛

```bash
foundry model run your-finetuned-model-int4
```

### рикрйНри░рижри░ри╕ри╝рии римрйИриВриЪриори╛ри░риХри┐рй░риЧ

риЯрйИри╕риЯри┐рй░риЧ рижрйМри░ри╛рии риорйБрй▒риЦ риори╛рикрижрй░рибри╛риВ рижрйА риири┐риЧри░ри╛риирйА риХри░рйЛ:

1. **ри░ри┐ри╕рикри╛риВри╕ риЯри╛риИрио**: рикрйНри░ридрйА ри░ри┐ри╕рикри╛риВри╕ риФри╕рид ри╕риори╛риВ риори╛рикрйЛ
2. **риорйИриори░рйА ри╡ри░ридрйЛриВ**: RAM рижрйА риЦрикрид рижрйА риири┐риЧри░ри╛риирйА риХри░рйЛ
3. **CPU рипрйВриЯри┐ри▓ри╛риИриЬри╝рйЗри╕ри╝рии**: рикрйНри░рйЛри╕рйИри╕ри░ ри▓рйЛриб рижрйА риЬри╛риВриЪ риХри░рйЛ
4. **риЖриЙриЯрикрйБрй▒риЯ риЧрйБригри╡рй▒ридри╛**: ри░ри┐ри╕рикри╛риВри╕ рижрйА ри╕римрй░ризридри╛ риЕридрйЗ ри╕рй░риЧридрйА рижри╛ риорйБри▓ри╛риВриХриг риХри░рйЛ

### риЧрйБригри╡рй▒ридри╛ ри╡рйИризридри╛ риЪрйИрй▒риХри▓ри┐ри╕риЯ

- тЬЕ риори╛рибри▓ рилри╛риИрии-риЯри┐риКрии рибрйЛриорйЗрии риХрйБриЗри░рйАриЬри╝ риирйВрй░ риарйАриХ ридри░рйАриХрйЗ риири╛ри▓ риЬри╡ри╛рим рижри┐рй░рижри╛ ри╣рйИ
- тЬЕ ри░ри┐ри╕рикри╛риВри╕ рилри╛ри░риорйИриЯ риЙриорйАриж риХрйАридрйЗ риЖриЙриЯрикрйБрй▒риЯ ри╕риЯрйНри░риХриЪри░ риири╛ри▓ риорйЗри▓ риЦри╛риВрижри╛ ри╣рйИ
- тЬЕ ри▓рй░римрйЗ ри╕риорйЗриВ рижрйА ри╡ри░ридрйЛриВ рижрйМри░ри╛рии риХрйЛриИ риорйИриори░рйА ри▓рйАриХ риири╣рйАриВ
- тЬЕ ри╡рй▒риЦ-ри╡рй▒риЦ риЗриирикрйБриЯ ри▓рй░римри╛риИриЖриВ 'ридрйЗ ри╕риери┐ри░ рикрйНри░рижри░ри╕ри╝рии
- тЬЕ риРриЬ риХрйЗри╕ри╛риВ риЕридрйЗ риЕри╡рйИриз риЗриирикрйБриЯри╛риВ рижрйА ри╕ри╣рйА ри╣рйИриВрибри▓ри┐рй░риЧ

## ри╕ри╛ри░

риорйБримри╛ри░риХри╛риВ! ридрйБри╕рйАриВ ри╕рилри▓ридри╛рикрйВри░ри╡риХ рикрйВри░ри╛ риХрйАридри╛:

- тЬЕ рилри╛риИрии-риЯри┐риКрии риори╛рибри▓ рилри╛ри░риорйИриЯ риХриири╡ри░риЬри╝рии
- тЬЕ риори╛рибри▓ риХри╡ри╛риВриЯри╛риИриЬри╝рйЗри╕ри╝рии риУрикриЯрйАриори╛риИриЬри╝рйЗри╕ри╝рии
- тЬЕ Foundry Local рибри┐рикри▓рйМриЗриорйИриВриЯ риХриирилри┐риЧри░рйЗри╕ри╝рии
- тЬЕ рикрйНри░рижри░ри╕ри╝рии риЯри┐риКриири┐рй░риЧ риЕридрйЗ риЯрйНри░римри▓ри╕ри╝рйВриЯри┐рй░риЧ

---

**риЕри╕ри╡рйАриХри╛ри░риири╛**:  
риЗри╣ рижри╕ридри╛ри╡рйЗриЬри╝ AI риЕриирйБри╡ри╛риж ри╕рйЗри╡ри╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рижрйА ри╡ри░ридрйЛриВ риХри░риХрйЗ риЕриирйБри╡ри╛риж риХрйАридри╛ риЧри┐риЖ ри╣рйИред ри╣ри╛ри▓ри╛риВриХри┐ риЕри╕рйАриВ ри╕ри╣рйАриЕридри╛ ри▓риИ рипридриири╕ри╝рйАри▓ ри╣ри╛риВ, риХри┐ри░рикри╛ риХри░риХрйЗ ризри┐риЖрии рижри┐риУ риХри┐ ри╕ри╡рйИриЪри╛ри▓ри┐рид риЕриирйБри╡ри╛рижри╛риВ ри╡ри┐рй▒риЪ риЧри▓ридрйАриЖриВ риЬри╛риВ риЕри╕рйБриЪрйАридридри╛ри╡ри╛риВ ри╣рйЛ ри╕риХрижрйАриЖриВ ри╣рииред риорйВри▓ рижри╕ридри╛ри╡рйЗриЬри╝, риЬрйЛ риЗри╕рижрйА риорйВри▓ ринри╛ри╕ри╝ри╛ ри╡ри┐рй▒риЪ ри╣рйИ, риирйВрй░ риЕризри┐риХри╛ри░рид ри╕ри░рйЛрид риорй░риири┐риЖ риЬри╛ригри╛ риЪри╛ри╣рйАрижри╛ ри╣рйИред риори╣рй▒ридри╡рикрйВри░рии риЬри╛ригриХри╛ри░рйА ри▓риИ, рикрйЗри╕ри╝рйЗри╡ри░ риориирйБрй▒риЦрйА риЕриирйБри╡ри╛риж рижрйА ри╕ри┐рилри╛ри░ри╕ри╝ риХрйАридрйА риЬри╛риВрижрйА ри╣рйИред риЗри╕ риЕриирйБри╡ри╛риж рижрйА ри╡ри░ридрйЛриВ ридрйЛриВ рикрйИрижри╛ ри╣рйЛриг ри╡ри╛ри▓рйЗ риХри┐ри╕рйЗ ри╡рйА риЧри▓ридрилри╣ри┐риорйА риЬри╛риВ риЧри▓рид ри╡ри┐риЖриЦри┐риЖ ри▓риИ риЕри╕рйАриВ риЬри╝ри┐рй░риорйЗри╡ри╛ри░ риири╣рйАриВ ри╣ри╛риВред