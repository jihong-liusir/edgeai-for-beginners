<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "ad0c054ebd3de404d997d1707a513c70",
  "translation_date": "2025-09-18T17:13:47+00:00",
  "source_file": "Module05/04.SLMOps.Deployment.md",
  "language_code": "sw"
}
-->
# Sehemu ya 4: Utekelezaji wa Modeli Tayari kwa Uzalishaji

## Muhtasari

Mafunzo haya ya kina yatakuongoza kupitia mchakato mzima wa kupeleka modeli zilizoboreshwa na kuwekewa kiwango kwa kutumia Foundry Local. Tutashughulikia ubadilishaji wa modeli, uboreshaji wa kiwango, na usanidi wa utekelezaji kutoka mwanzo hadi mwisho.

## Mahitaji ya Awali

Kabla ya kuanza, hakikisha unayo yafuatayo:

- ‚úÖ Modeli ya onnx iliyoboreshwa tayari kwa utekelezaji
- ‚úÖ Kompyuta ya Windows au Mac
- ‚úÖ Python 3.10 au zaidi
- ‚úÖ Angalau RAM ya 8GB inayopatikana
- ‚úÖ Foundry Local imewekwa kwenye mfumo wako

## Sehemu ya 1: Usanidi wa Mazingira

### Kusakinisha Zana Zinazohitajika

Fungua terminal yako (Command Prompt kwenye Windows, Terminal kwenye Mac) na endesha amri zifuatazo kwa mpangilio:

```bash
# Update transformers library to the latest version
pip install transformers -U

# Install Microsoft Olive (model conversion tool)
pip install git+https://github.com/microsoft/Olive.git

# Install ONNX Runtime GenAI
git clone https://github.com/microsoft/onnxruntime-genai
cd onnxruntime-genai && python build.py --config Release
pip install {Your build release path}/onnxruntime_genai-0.9.0.dev0-cp311-cp311-linux_x86_64.whl

# Install additional dependencies
pip install onnx onnxruntime numpy
```

‚ö†Ô∏è **Kumbuka Muhimu**: Utahitaji pia CMake toleo la 3.31 au jipya zaidi, ambalo linaweza kupakuliwa kutoka [cmake.org](https://cmake.org/download/).

## Sehemu ya 2: Ubadilishaji wa Modeli na Kuweka Kiwango

### Kuchagua Umbizo Sahihi

Kwa modeli ndogo za lugha zilizoboreshwa, tunapendekeza kutumia **umbizo la ONNX** kwa sababu linatoa:

- üöÄ Uboreshaji bora wa utendaji
- üîß Utekelezaji usiofungamana na vifaa
- üè≠ Uwezo wa uzalishaji
- üì± Utangamano wa majukwaa mbalimbali

### Njia ya 1: Ubadilishaji kwa Amri Moja (Inapendekezwa)

Tumia amri ifuatayo kubadilisha moja kwa moja modeli yako iliyoboreshwa:

```bash
olive auto-opt \
    --model_name_or_path /path/to/your/finetuned/model \
    --device cpu \
    --provider CPUExecutionProvider \
    --use_model_builder \
    --precision int4 \
    --output_path models/your-model-name/onnx \
    --log_level 1
```

**Maelezo ya Vigezo:**
- `--model_name_or_path`: Njia ya modeli yako iliyoboreshwa
- `--device cpu`: Tumia CPU kwa uboreshaji
- `--precision int4`: Tumia kiwango cha INT4 (kupunguza ukubwa kwa takriban 75%)
- `--output_path`: Njia ya matokeo ya modeli iliyobadilishwa

### Njia ya 2: Njia ya Faili ya Usanidi (Watumiaji Wenye Uzoefu)

Tengeneza faili ya usanidi inayoitwa `finetuned_conversion_config.json`:

```json
{
    "input_model": {
        "type": "HfModel",
        "model_path": "/path/to/your/finetuned/model",
        "task": "text-generation"
    },
    "systems": {
        "local_system": {
            "type": "LocalSystem",
            "accelerators": [
                {
                    "execution_providers": [
                        "CPUExecutionProvider"
                    ]
                }
            ]
        }
    },
    "passes": {
        "builder": {
            "type": "ModelBuilder",
            "config": {
                "precision": "int4",
                "quantization_config": {
                    "block_size": 128,
                    "is_symmetric": false
                }
            }
        }
    },
    "host": "local_system",
    "target": "local_system",
    "cache_dir": "cache",
    "output_dir": "models/output/your-finetuned-model-onnx"
}
```

Kisha endesha:

```bash
olive run --config ./finetuned_conversion_config.json
```

### Ulinganisho wa Chaguo za Kuweka Kiwango

| Usahihi   | Ukubwa wa Faili | Kasi ya Utoaji | Ubora wa Modeli | Matumizi Yanayopendekezwa |
|-----------|-----------------|----------------|-----------------|--------------------------|
| FP16      | Msingi √ó 0.5    | Haraka         | Bora            | Vifaa vya hali ya juu    |
| INT8      | Msingi √ó 0.25   | Haraka Sana    | Nzuri           | Chaguo la usawa          |
| INT4      | Msingi √ó 0.125  | Haraka Zaidi   | Inakubalika     | Rasilimali chache        |

üí° **Pendekezo**: Anza na kiwango cha INT4 kwa utekelezaji wako wa kwanza. Ikiwa ubora hautatosheleza, jaribu INT8 au FP16.

## Sehemu ya 3: Usanidi wa Utekelezaji wa Foundry Local

### Kutengeneza Usanidi wa Modeli

Nenda kwenye saraka ya modeli za Foundry Local:

```bash
foundry cache cd ./models/
```

Tengeneza muundo wa saraka ya modeli yako:

```bash
mkdir -p ./models/custom/your-finetuned-model
```

Tengeneza faili ya usanidi `inference_model.json` kwenye saraka ya modeli yako:

```json
{
  "Name": "your-finetuned-model-int4",
  "Description": "Fine-tuned quantized model",
  "Version": "1.0",
  "PromptTemplate": {
    "system": "<|im_start|>system\n{Content}<|im_end|>",
    "user": "<|im_start|>user\n{Content}<|im_end|>",
    "assistant": "<|im_start|>assistant\n{Content}<|im_end|>",
    "prompt": "<|im_start|>user\n{Content}<|im_end|>\n<|im_start|>assistant"
  },
  "ModelConfig": {
    "max_length": 2048,
    "temperature": 0.7,
    "top_p": 0.9,
    "repetition_penalty": 1.1
  }
}
```

### Usanidi wa Violezo Maalum vya Modeli

#### Kwa Modeli za Mfululizo wa Qwen:

```json
{
  "Name": "qwen-finetuned-int4",
  "PromptTemplate": {
    "system": "<|im_start|>system\n{Content}<|im_end|>",
    "user": "<|im_start|>user\n{Content}<|im_end|>",
    "assistant": "<|im_start|>assistant\n{Content}<|im_end|>",
    "prompt": "<|im_start|>user\n{Content}<|im_end|>\n<|im_start|>assistant"
  }
}
```

## Sehemu ya 4: Upimaji na Uboreshaji wa Modeli

### Kuhakikisha Usakinishaji wa Modeli

Angalia kama Foundry Local inaweza kutambua modeli yako:

```bash
foundry cache ls
```

Unapaswa kuona `your-finetuned-model-int4` kwenye orodha.

### Kuanza Upimaji wa Modeli

```bash
foundry model run your-finetuned-model-int4
```

### Upimaji wa Utendaji

Fuatilia vipimo muhimu wakati wa upimaji:

1. **Muda wa Kujibu**: Pima muda wa wastani kwa kila jibu
2. **Matumizi ya Kumbukumbu**: Fuatilia matumizi ya RAM
3. **Matumizi ya CPU**: Angalia mzigo wa processor
4. **Ubora wa Matokeo**: Tathmini umuhimu na usahihi wa majibu

### Orodha ya Uthibitishaji wa Ubora

- ‚úÖ Modeli inajibu ipasavyo maswali ya uwanja ulioboreshwa
- ‚úÖ Muundo wa majibu unalingana na muundo wa matokeo unaotarajiwa
- ‚úÖ Hakuna uvujaji wa kumbukumbu wakati wa matumizi ya muda mrefu
- ‚úÖ Utendaji thabiti kwa urefu tofauti wa pembejeo
- ‚úÖ Ushughulikiaji sahihi wa hali za kipekee na pembejeo batili

## Muhtasari

Hongera! Umefanikiwa kukamilisha:

- ‚úÖ Ubadilishaji wa umbizo la modeli iliyoboreshwa
- ‚úÖ Uboreshaji wa kiwango cha modeli
- ‚úÖ Usanidi wa utekelezaji wa Foundry Local
- ‚úÖ Uboreshaji wa utendaji na utatuzi wa matatizo

---

**Kanusho**:  
Hati hii imetafsiriwa kwa kutumia huduma ya tafsiri ya AI [Co-op Translator](https://github.com/Azure/co-op-translator). Ingawa tunajitahidi kuhakikisha usahihi, tafsiri za kiotomatiki zinaweza kuwa na makosa au kutokuwa sahihi. Hati ya asili katika lugha yake ya awali inapaswa kuchukuliwa kama chanzo cha mamlaka. Kwa taarifa muhimu, tafsiri ya kitaalamu ya binadamu inapendekezwa. Hatutawajibika kwa kutoelewana au tafsiri zisizo sahihi zinazotokana na matumizi ya tafsiri hii.