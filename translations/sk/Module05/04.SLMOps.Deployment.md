<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "ad0c054ebd3de404d997d1707a513c70",
  "translation_date": "2025-09-18T19:02:40+00:00",
  "source_file": "Module05/04.SLMOps.Deployment.md",
  "language_code": "sk"
}
-->
# Sekcia 4: Nasadenie - Implementácia modelu pripraveného na produkciu

## Prehľad

Tento komplexný návod vás prevedie celým procesom nasadenia jemne doladených kvantizovaných modelov pomocou Foundry Local. Pokryjeme konverziu modelu, optimalizáciu kvantizácie a konfiguráciu nasadenia od začiatku až do konca.

## Predpoklady

Pred začiatkom sa uistite, že máte nasledovné:

- ✅ Jemne doladený onnx model pripravený na nasadenie
- ✅ Počítač s Windows alebo Mac
- ✅ Python 3.10 alebo novší
- ✅ Minimálne 8GB voľnej RAM
- ✅ Foundry Local nainštalovaný vo vašom systéme

## Časť 1: Nastavenie prostredia

### Inštalácia potrebných nástrojov

Otvorte svoj terminál (Command Prompt na Windows, Terminal na Mac) a spustite nasledujúce príkazy v poradí:

```bash
# Update transformers library to the latest version
pip install transformers -U

# Install Microsoft Olive (model conversion tool)
pip install git+https://github.com/microsoft/Olive.git

# Install ONNX Runtime GenAI
git clone https://github.com/microsoft/onnxruntime-genai
cd onnxruntime-genai && python build.py --config Release
pip install {Your build release path}/onnxruntime_genai-0.9.0.dev0-cp311-cp311-linux_x86_64.whl

# Install additional dependencies
pip install onnx onnxruntime numpy
```

⚠️ **Dôležitá poznámka**: Budete potrebovať aj CMake verziu 3.31 alebo novšiu, ktorú si môžete stiahnuť z [cmake.org](https://cmake.org/download/).

## Časť 2: Konverzia a kvantizácia modelu

### Výber správneho formátu

Pre jemne doladené malé jazykové modely odporúčame používať **ONNX formát**, pretože ponúka:

- 🚀 Lepšiu optimalizáciu výkonu
- 🔧 Hardvérovo nezávislé nasadenie
- 🏭 Schopnosti pripravené na produkciu
- 📱 Kompatibilitu naprieč platformami

### Metóda 1: Konverzia jedným príkazom (Odporúčané)

Použite nasledujúci príkaz na priamu konverziu vášho jemne doladeného modelu:

```bash
olive auto-opt \
    --model_name_or_path /path/to/your/finetuned/model \
    --device cpu \
    --provider CPUExecutionProvider \
    --use_model_builder \
    --precision int4 \
    --output_path models/your-model-name/onnx \
    --log_level 1
```

**Vysvetlenie parametrov:**
- `--model_name_or_path`: Cesta k vášmu jemne doladenému modelu
- `--device cpu`: Použitie CPU na optimalizáciu
- `--precision int4`: Použitie INT4 kvantizácie (približne 75% zníženie veľkosti)
- `--output_path`: Výstupná cesta pre konvertovaný model

### Metóda 2: Prístup pomocou konfiguračného súboru (Pokročilí používatelia)

Vytvorte konfiguračný súbor s názvom `finetuned_conversion_config.json`:

```json
{
    "input_model": {
        "type": "HfModel",
        "model_path": "/path/to/your/finetuned/model",
        "task": "text-generation"
    },
    "systems": {
        "local_system": {
            "type": "LocalSystem",
            "accelerators": [
                {
                    "execution_providers": [
                        "CPUExecutionProvider"
                    ]
                }
            ]
        }
    },
    "passes": {
        "builder": {
            "type": "ModelBuilder",
            "config": {
                "precision": "int4",
                "quantization_config": {
                    "block_size": 128,
                    "is_symmetric": false
                }
            }
        }
    },
    "host": "local_system",
    "target": "local_system",
    "cache_dir": "cache",
    "output_dir": "models/output/your-finetuned-model-onnx"
}
```

Potom spustite:

```bash
olive run --config ./finetuned_conversion_config.json
```

### Porovnanie možností kvantizácie

| Presnosť | Veľkosť súboru | Rýchlosť inferencie | Kvalita modelu | Odporúčané použitie |
|----------|----------------|---------------------|----------------|---------------------|
| FP16     | Základ × 0.5   | Rýchla             | Najlepšia      | High-end hardvér    |
| INT8     | Základ × 0.25  | Veľmi rýchla       | Dobrá          | Vyvážená voľba      |
| INT4     | Základ × 0.125 | Najrýchlejšia      | Prijateľná     | Obmedzené zdroje    |

💡 **Odporúčanie**: Začnite s kvantizáciou INT4 pre vaše prvé nasadenie. Ak kvalita nebude uspokojivá, skúste INT8 alebo FP16.

## Časť 3: Konfigurácia nasadenia vo Foundry Local

### Vytvorenie konfigurácie modelu

Prejdite do adresára modelov Foundry Local:

```bash
foundry cache cd ./models/
```

Vytvorte štruktúru adresára modelu:

```bash
mkdir -p ./models/custom/your-finetuned-model
```

Vytvorte konfiguračný súbor `inference_model.json` vo vašom adresári modelu:

```json
{
  "Name": "your-finetuned-model-int4",
  "Description": "Fine-tuned quantized model",
  "Version": "1.0",
  "PromptTemplate": {
    "system": "<|im_start|>system\n{Content}<|im_end|>",
    "user": "<|im_start|>user\n{Content}<|im_end|>",
    "assistant": "<|im_start|>assistant\n{Content}<|im_end|>",
    "prompt": "<|im_start|>user\n{Content}<|im_end|>\n<|im_start|>assistant"
  },
  "ModelConfig": {
    "max_length": 2048,
    "temperature": 0.7,
    "top_p": 0.9,
    "repetition_penalty": 1.1
  }
}
```

### Šablóny konfigurácií špecifické pre model

#### Pre modely série Qwen:

```json
{
  "Name": "qwen-finetuned-int4",
  "PromptTemplate": {
    "system": "<|im_start|>system\n{Content}<|im_end|>",
    "user": "<|im_start|>user\n{Content}<|im_end|>",
    "assistant": "<|im_start|>assistant\n{Content}<|im_end|>",
    "prompt": "<|im_start|>user\n{Content}<|im_end|>\n<|im_start|>assistant"
  }
}
```

## Časť 4: Testovanie a optimalizácia modelu

### Overenie inštalácie modelu

Skontrolujte, či Foundry Local rozpozná váš model:

```bash
foundry cache ls
```

Mali by ste vidieť `your-finetuned-model-int4` v zozname.

### Spustenie testovania modelu

```bash
foundry model run your-finetuned-model-int4
```

### Benchmarking výkonu

Monitorujte kľúčové metriky počas testovania:

1. **Čas odozvy**: Merajte priemerný čas na odpoveď
2. **Využitie pamäte**: Sledujte spotrebu RAM
3. **Využitie CPU**: Kontrolujte zaťaženie procesora
4. **Kvalita výstupu**: Hodnoťte relevantnosť a súdržnosť odpovedí

### Kontrolný zoznam validácie kvality

- ✅ Model správne reaguje na dotazy z jemne doladeného doménového prostredia
- ✅ Formát odpovede zodpovedá očakávanej štruktúre výstupu
- ✅ Počas dlhodobého používania nedochádza k únikom pamäte
- ✅ Konzistentný výkon pri rôznych dĺžkach vstupov
- ✅ Správne spracovanie hraničných prípadov a neplatných vstupov

## Zhrnutie

Gratulujeme! Úspešne ste dokončili:

- ✅ Konverziu formátu jemne doladeného modelu
- ✅ Optimalizáciu kvantizácie modelu
- ✅ Konfiguráciu nasadenia vo Foundry Local
- ✅ Ladenie výkonu a riešenie problémov

---

**Upozornenie**:  
Tento dokument bol preložený pomocou služby AI prekladu [Co-op Translator](https://github.com/Azure/co-op-translator). Hoci sa snažíme o presnosť, prosím, berte na vedomie, že automatizované preklady môžu obsahovať chyby alebo nepresnosti. Pôvodný dokument v jeho pôvodnom jazyku by mal byť považovaný za autoritatívny zdroj. Pre kritické informácie sa odporúča profesionálny ľudský preklad. Nie sme zodpovední za žiadne nedorozumenia alebo nesprávne interpretácie vyplývajúce z použitia tohto prekladu.