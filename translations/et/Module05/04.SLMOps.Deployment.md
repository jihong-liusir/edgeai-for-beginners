<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "ad0c054ebd3de404d997d1707a513c70",
  "translation_date": "2025-10-11T11:18:23+00:00",
  "source_file": "Module05/04.SLMOps.Deployment.md",
  "language_code": "et"
}
-->
# Sektsioon 4: Juurutamine - Tootmisvalmis mudeli rakendamine

## √úlevaade

See p√µhjalik juhend aitab teil samm-sammult juurutada peenh√§√§lestatud kvantiseeritud mudeleid, kasutades Foundry Locali. Katame mudeli konverteerimise, kvantiseerimise optimeerimise ja juurutamise konfiguratsiooni algusest l√µpuni.

## Eeltingimused

Enne alustamist veenduge, et teil on olemas:

- ‚úÖ Peenh√§√§lestatud ONNX mudel, mis on valmis juurutamiseks
- ‚úÖ Windowsi v√µi Maci arvuti
- ‚úÖ Python 3.10 v√µi uuem
- ‚úÖ V√§hemalt 8GB vaba RAM-i
- ‚úÖ Foundry Local teie s√ºsteemis installitud

## Osa 1: Keskkonna seadistamine

### Vajalikud t√∂√∂riistad

Avage oma terminal (Command Prompt Windowsis, Terminal Macis) ja k√§ivitage j√§rgmised k√§sud j√§rjestikku:

```bash
# Update transformers library to the latest version
pip install transformers -U

# Install Microsoft Olive (model conversion tool)
pip install git+https://github.com/microsoft/Olive.git

# Install ONNX Runtime GenAI
git clone https://github.com/microsoft/onnxruntime-genai
cd onnxruntime-genai && python build.py --config Release
pip install {Your build release path}/onnxruntime_genai-0.9.0.dev0-cp311-cp311-linux_x86_64.whl

# Install additional dependencies
pip install onnx onnxruntime numpy
```

‚ö†Ô∏è **Oluline m√§rkus**: Teil on vaja ka CMake versiooni 3.31 v√µi uuemat, mille saab alla laadida [cmake.org](https://cmake.org/download/).

## Osa 2: Mudeli konverteerimine ja kvantiseerimine

### √ïige formaadi valimine

Peenh√§√§lestatud v√§ikeste keelemudelite jaoks soovitame kasutada **ONNX formaati**, kuna see pakub:

- üöÄ Paremat j√µudluse optimeerimist
- üîß Riistvarast s√µltumatut juurutamist
- üè≠ Tootmisvalmis v√µimekust
- üì± Platvormidevahelist √ºhilduvust

### Meetod 1: √úhe k√§suga konverteerimine (soovitatav)

Kasutage j√§rgmist k√§sku, et otse konverteerida oma peenh√§√§lestatud mudel:

```bash
olive auto-opt \
    --model_name_or_path /path/to/your/finetuned/model \
    --device cpu \
    --provider CPUExecutionProvider \
    --use_model_builder \
    --precision int4 \
    --output_path models/your-model-name/onnx \
    --log_level 1
```

**Parameetrite selgitus:**
- `--model_name_or_path`: Teie peenh√§√§lestatud mudeli tee
- `--device cpu`: Kasutage optimeerimiseks CPU-d
- `--precision int4`: Kasutage INT4 kvantiseerimist (umbes 75% suuruse v√§hendamine)
- `--output_path`: Konverteeritud mudeli v√§ljundtee

### Meetod 2: Konfiguratsioonifaili l√§henemine (edasij√µudnud kasutajatele)

Looge konfiguratsioonifail nimega `finetuned_conversion_config.json`:

```json
{
    "input_model": {
        "type": "HfModel",
        "model_path": "/path/to/your/finetuned/model",
        "task": "text-generation"
    },
    "systems": {
        "local_system": {
            "type": "LocalSystem",
            "accelerators": [
                {
                    "execution_providers": [
                        "CPUExecutionProvider"
                    ]
                }
            ]
        }
    },
    "passes": {
        "builder": {
            "type": "ModelBuilder",
            "config": {
                "precision": "int4",
                "quantization_config": {
                    "block_size": 128,
                    "is_symmetric": false
                }
            }
        }
    },
    "host": "local_system",
    "target": "local_system",
    "cache_dir": "cache",
    "output_dir": "models/output/your-finetuned-model-onnx"
}
```

Seej√§rel k√§ivitage:

```bash
olive run --config ./finetuned_conversion_config.json
```

### Kvantiseerimisvalikute v√µrdlus

| T√§psus     | Faili suurus | J√§reldamise kiirus | Mudeli kvaliteet | Soovitatav kasutus |
|------------|-------------|--------------------|------------------|--------------------|
| FP16       | Algtase √ó 0.5 | Kiire             | Parim            | K√µrgekvaliteediline riistvara |
| INT8       | Algtase √ó 0.25 | V√§ga kiire        | Hea              | Tasakaalustatud valik |
| INT4       | Algtase √ó 0.125 | K√µige kiirem      | Vastuv√µetav      | Piiratud ressursid |

üí° **Soovitus**: Alustage INT4 kvantiseerimisega oma esimesel juurutamisel. Kui kvaliteet ei ole rahuldav, proovige INT8 v√µi FP16.

## Osa 3: Foundry Locali juurutamise konfiguratsioon

### Mudeli konfiguratsiooni loomine

Liikuge Foundry Locali mudelite kataloogi:

```bash
foundry cache cd ./models/
```

Looge oma mudeli kataloogi struktuur:

```bash
mkdir -p ./models/custom/your-finetuned-model
```

Looge `inference_model.json` konfiguratsioonifail oma mudeli kataloogi:

```json
{
  "Name": "your-finetuned-model-int4",
  "Description": "Fine-tuned quantized model",
  "Version": "1.0",
  "PromptTemplate": {
    "system": "<|im_start|>system\n{Content}<|im_end|>",
    "user": "<|im_start|>user\n{Content}<|im_end|>",
    "assistant": "<|im_start|>assistant\n{Content}<|im_end|>",
    "prompt": "<|im_start|>user\n{Content}<|im_end|>\n<|im_start|>assistant"
  },
  "ModelConfig": {
    "max_length": 2048,
    "temperature": 0.7,
    "top_p": 0.9,
    "repetition_penalty": 1.1
  }
}
```

### Mudelispetsiifilised mallikonfiguratsioonid

#### Qwen seeria mudelite jaoks:

```json
{
  "Name": "qwen-finetuned-int4",
  "PromptTemplate": {
    "system": "<|im_start|>system\n{Content}<|im_end|>",
    "user": "<|im_start|>user\n{Content}<|im_end|>",
    "assistant": "<|im_start|>assistant\n{Content}<|im_end|>",
    "prompt": "<|im_start|>user\n{Content}<|im_end|>\n<|im_start|>assistant"
  }
}
```


## Osa 4: Mudeli testimine ja optimeerimine

### Mudeli installatsiooni kontrollimine

Kontrollige, kas Foundry Local tunneb teie mudeli √§ra:

```bash
foundry cache ls
```

Te peaksite n√§gema `your-finetuned-model-int4` loendis.

### Mudeli testimise alustamine

```bash
foundry model run your-finetuned-model-int4
```

### J√µudluse hindamine

J√§lgige testimise ajal j√§rgmisi v√µtmem√µ√µdikuid:

1. **Reaktsiooniaeg**: M√µ√µtke keskmist aega vastuse kohta
2. **M√§lu kasutus**: J√§lgige RAM-i tarbimist
3. **CPU kasutus**: Kontrollige protsessori koormust
4. **V√§ljundi kvaliteet**: Hinnake vastuste asjakohasust ja sidusust

### Kvaliteedi valideerimise kontrollnimekiri

- ‚úÖ Mudel vastab asjakohaselt peenh√§√§lestatud valdkonna p√§ringutele
- ‚úÖ Vastuse formaat vastab oodatud v√§ljundi struktuurile
- ‚úÖ Pikema kasutamise ajal ei esine m√§lulekkeid
- ‚úÖ J√§rjepidev j√µudlus erinevate sisendite pikkuste korral
- ‚úÖ Korralik k√§sitsemine erijuhtumite ja vigaste sisendite korral

## Kokkuv√µte

Palju √µnne! Olete edukalt l√µpetanud:

- ‚úÖ Peenh√§√§lestatud mudeli formaadi konverteerimise
- ‚úÖ Mudeli kvantiseerimise optimeerimise
- ‚úÖ Foundry Locali juurutamise konfiguratsiooni
- ‚úÖ J√µudluse h√§√§lestamise ja t√µrkeotsingu

---

**Lahti√ºtlus**:  
See dokument on t√µlgitud, kasutades AI t√µlketeenust [Co-op Translator](https://github.com/Azure/co-op-translator). Kuigi p√º√ºame tagada t√§psust, palun arvestage, et automaatsed t√µlked v√µivad sisaldada vigu v√µi ebat√§psusi. Algne dokument selle algkeeles tuleks lugeda autoriteetseks allikaks. Olulise teabe puhul soovitame kasutada professionaalset inimt√µlget. Me ei vastuta selle t√µlke kasutamisest tulenevate arusaamatuste v√µi valede t√µlgenduste eest.