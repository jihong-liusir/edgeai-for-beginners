<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "b6bd5b920b610665fd0462f6b5c2e134",
  "translation_date": "2025-10-11T11:28:17+00:00",
  "source_file": "Module06/03.IntroduceMCP.md",
  "language_code": "et"
}
-->
# Jaotis 03 - Mudeli Konteksti Protokolli (MCP) integreerimine

## Sissejuhatus MCP-sse (Mudeli Konteksti Protokoll)

Mudeli Konteksti Protokoll (MCP) on revolutsiooniline raamistik, mis võimaldab keelemudelitel suhelda väliste tööriistade ja süsteemidega standardiseeritud viisil. Erinevalt traditsioonilistest lähenemistest, kus mudelid on isoleeritud, loob MCP silla tehisintellekti mudelite ja reaalse maailma vahel läbi hästi määratletud protokolli.

### Mis on MCP?

MCP toimib suhtlusprotokollina, mis võimaldab keelemudelitel:
- Ühenduda väliste andmeallikatega
- Käivitada tööriistu ja funktsioone
- Suhelda API-de ja teenustega
- Juurdepääsu reaalajas teabele
- Teostada keerukaid mitmeastmelisi operatsioone

See protokoll muudab staatilised keelemudelid dünaamilisteks agentideks, kes suudavad täita praktilisi ülesandeid, mis ulatuvad kaugemale pelgalt teksti genereerimisest.

## Väikesed Keelemudelid (SLM-id) MCP-s

Väikesed Keelemudelid esindavad tõhusat lähenemist tehisintellekti juurutamisele, pakkudes mitmeid eeliseid:

### SLM-ide eelised
- **Ressursitõhusus**: Madalamad arvutusnõuded
- **Kiirem reageerimisaeg**: Väiksem latentsus reaalajas rakenduste jaoks  
- **Kuluefektiivsus**: Minimaalsed infrastruktuuri vajadused
- **Privaatsus**: Võimalus töötada lokaalselt ilma andmete edastamiseta
- **Kohandatavus**: Lihtsam kohandada spetsiifilistele valdkondadele

### Miks SLM-id sobivad hästi MCP-ga

SLM-id koos MCP-ga loovad võimsa kombinatsiooni, kus mudeli mõtlemisvõimeid täiustatakse väliste tööriistade abil, kompenseerides nende väiksemat parameetrite arvu suurema funktsionaalsusega.

## Python MCP SDK ülevaade

Python MCP SDK pakub alust MCP-toega rakenduste loomiseks. SDK sisaldab:

- **Klienditeeke**: MCP serveritega ühenduse loomiseks
- **Serveriraamistikku**: Kohandatud MCP serverite loomiseks
- **Protokolli haldureid**: Suhtluse haldamiseks
- **Tööriistade integreerimist**: Väliste funktsioonide käivitamiseks

## Praktiline teostus: Phi-4 MCP klient

Vaatame reaalset teostust, kus Microsofti Phi-4 mini mudel on integreeritud MCP võimalustega.

### Süsteemi arhitektuur

Teostus järgib kihilist arhitektuuri:

```
┌─────────────────────────────────────┐
│        Application Layer           │
│  ├── Interactive Loop              │
│  ├── CLI Interface                 │
│  └── Configuration Management      │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│         LLM Client Layer           │
│  ├── OllamaClient                  │
│  ├── VLLMClient                    │
│  └── LLMClient (Abstract)          │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│        MCP Client Layer            │
│  ├── Phi4MiniMCPClient (STDIO)     │
│  ├── Phi4MiniSSEMCPClient (SSE)    │
│  └── BaseMCPClient (Abstract)      │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│      Tool Processing Layer         │
│  ├── ToolCallHandler               │
│  ├── Function Format Transformer   │
│  └── Tool Schema Management        │
└─────────────────────────────────────┘
```

### Põhikomponendid

#### 1. MCP kliendiklassid

**BaseMCPClient**: Abstraktne alus, mis pakub üldist funktsionaalsust
- Asünkroonne konteksti haldamise protokoll
- Standardne liidese määratlus
- Ressursside haldamine

**Phi4MiniMCPClient**: STDIO-põhine teostus
- Kohalik protsessisuhtlus
- Standardse sisendi/väljundi haldamine
- Alaprotsesside haldamine

**Phi4MiniSSEMCPClient**: Server-Sent Events teostus
- HTTP voogedastuse suhtlus
- Reaalajas sündmuste haldamine
- Veebipõhine serveriühendus

#### 2. LLM-i integreerimine

**OllamaClient**: Kohalik mudeli hostimine  
```python
class OllamaClient(LLMClient):
    def __init__(self):
        self.url = "http://localhost:11434/api/chat"
        self.model_id = "phi4-mini:3.8b-fp16"
```
  
**VLLMClient**: Kõrge jõudlusega teenindus  
```python
class VLLMClient(LLMClient):
    def __init__(self):
        self.url = "http://localhost:8000/v1"
        self.model_id = "microsoft/Phi-4-mini-instruct"
```
  
#### 3. Tööriistade töötlemise torujuhe

Tööriistade töötlemise torujuhe teisendab MCP tööriistad keelemudelitega ühilduvatesse vormingutesse:

```python
def transform_functions_format(input_data):
    """Convert MCP tool schemas to LLM-compatible formats"""
    # Maps OpenAPI schemas to function calling schemas
    # Handles parameter type conversion
    # Maintains required field information
```

## Alustamine: Samm-sammuline juhend

### Samm 1: Keskkonna seadistamine

Paigalda vajalikud sõltuvused:  
```bash
pip install fastmcp mcp-python-client openai requests pyautogui Pillow
```
  
### Samm 2: Põhikonfiguratsioon

Seadista oma keskkonnamuutujad:  
```python
# System Configuration
SYSTEM_PROMPT = "You are an AI assistant with some tools."

# Ollama Configuration (Local)
OLLAMA_URL = "http://localhost:11434/api/chat"
OLLAMA_MODEL_ID = "phi4-mini:3.8b-fp16"

# vLLM Configuration (Server)
VLLM_URL = "http://localhost:8000/v1"
VLLM_MODEL_ID = "microsoft/Phi-4-mini-instruct"
```
  
### Samm 3: Esimese MCP kliendi käivitamine

**Põhiline Ollama seadistus:**  
```bash
python ghmodel_mcp_demo.py
```
  
**vLLM taustsüsteemi kasutamine:**  
```bash
python ghmodel_mcp_demo.py --env vllm
```
  
**Server-Sent Events ühendus:**  
```bash
python ghmodel_mcp_demo.py --run sse
```
  
**Kohandatud MCP server:**  
```bash
python ghmodel_mcp_demo.py --server /path/to/server.py
```
  
### Samm 4: Programmiline kasutamine

```python
import asyncio
from ghmodel_mcp_demo import OllamaClient, Phi4MiniMCPClient

async def automated_interaction():
    # Configure MCP server parameters
    server_params = StdioServerParameters(
        command="npx",
        args=["@playwright/mcp@latest"],
        env=None,
    )
    
    # Create MCP client and process tools
    async with Phi4MiniMCPClient(server_params) as mcp_client:
        tools = await process_mcp_tools(mcp_client)
        llm_client = OllamaClient()
        
        # Generate response with tool capabilities
        response, messages = await llm_client.generate_response(
            "Help me automate a web task",
            tools
        )
        return response

# Execute the automation
result = asyncio.run(automated_interaction())
print(result)
```

## Täiustatud funktsioonid

### Mitme taustsüsteemi tugi

Teostus toetab nii Ollama kui ka vLLM taustsüsteeme, võimaldades valida vastavalt vajadustele:

- **Ollama**: Sobib paremini kohalikuks arenduseks ja testimiseks
- **vLLM**: Optimeeritud tootmiseks ja suure läbilaskevõimega stsenaariumide jaoks

### Paindlikud ühendusprotokollid

Toetatakse kahte ühendusrežiimi:

**STDIO režiim**: Otsene protsessisuhtlus
- Madalam latentsus
- Sobib kohalike tööriistade jaoks
- Lihtne seadistamine

**SSE režiim**: HTTP-põhine voogedastus
- Võrgukõlblik
- Sobib hajutatud süsteemidele
- Reaalajas uuendused

### Tööriistade integreerimise võimalused

Süsteem saab integreerida erinevaid tööriistu:
- Veebiautomaatika (Playwright)
- Failitoimingud
- API-dega suhtlemine
- Süsteemikäsklused
- Kohandatud funktsioonid

## Vigade käsitlemine ja parimad tavad

### Põhjalik vigade haldamine

Teostus sisaldab tugevat vigade käsitlemist järgmisteks juhtudeks:

**Ühendusvead:**
- MCP serveri tõrked
- Võrgu ajapiirangud
- Ühenduvusprobleemid

**Tööriistade käivitamise vead:**
- Puuduvad tööriistad
- Parameetrite valideerimine
- Käivitamise tõrked

**Vastuste töötlemise vead:**
- JSON-i parsimise probleemid
- Vormingute ebakõlad
- LLM-i vastuste anomaaliad

### Parimad tavad

1. **Ressursside haldamine**: Kasuta asünkroonseid konteksti haldureid
2. **Vigade käsitlemine**: Rakenda põhjalikke try-catch plokke
3. **Logimine**: Luba sobivad logimistasemed
4. **Turvalisus**: Valideeri sisendid ja puhasta väljundid
5. **Jõudlus**: Kasuta ühenduste vahemällu salvestamist ja puhverserverit

## Reaalsed rakendused

### Veebiautomaatika  
```python
# Example: Automated web testing
async def web_automation_example():
    tools = await setup_playwright_tools()
    response = await llm_client.generate_response(
        "Navigate to example.com and take a screenshot",
        tools
    )
```
  
### Andmetöötlus  
```python
# Example: File analysis
async def data_processing_example():
    tools = await setup_file_tools()
    response = await llm_client.generate_response(
        "Analyze the CSV file and generate a summary report",
        tools
    )
```
  
### API-de integreerimine  
```python
# Example: API interactions
async def api_integration_example():
    tools = await setup_api_tools()
    response = await llm_client.generate_response(
        "Fetch weather data and create a forecast summary",
        tools
    )
```
  
## Jõudluse optimeerimine

### Mälu haldamine
- Tõhus sõnumiajaloo haldamine
- Ressursside korrektne puhastamine
- Ühenduste vahemällu salvestamine

### Võrgu optimeerimine
- Asünkroonsed HTTP operatsioonid
- Konfigureeritavad ajapiirangud
- Sujuv vigade taastamine

### Samaaegne töötlemine
- Mitteblokeeriv I/O
- Paralleelne tööriistade käivitamine
- Tõhusad asünkroonsed mustrid

## Turvalisuse kaalutlused

### Andmekaitse
- API võtmete turvaline haldamine
- Sisendi valideerimine
- Väljundi puhastamine

### Võrgu turvalisus
- HTTPS tugi
- Kohalikud vaikimisi lõpp-punktid
- Turvaline tokenite haldamine

### Käivitamise ohutus
- Tööriistade filtreerimine
- Liivakastikeskkonnad
- Auditilogimine

## Kokkuvõte

SLM-ide integreerimine MCP-ga esindab paradigmanihet tehisintellekti rakenduste arendamisel. Kombineerides väikeste mudelite tõhususe väliste tööriistade võimekusega, saavad arendajad luua intelligentseid süsteeme, mis on nii ressursitõhusad kui ka väga võimekad.

Phi-4 MCP kliendi teostus näitab, kuidas seda integreerimist praktikas saavutada, pakkudes tugevat alust keerukate tehisintellekti rakenduste loomiseks.

Peamised järeldused:
- MCP loob silla keelemudelite ja väliste süsteemide vahel
- SLM-id pakuvad tõhusust, ohverdamata võimekust, kui neid täiendada tööriistadega
- Modulaarne arhitektuur võimaldab lihtsat laiendamist ja kohandamist
- Tootmiskasutuseks on olulised korralik vigade käsitlemine ja turvameetmed

See juhend pakub alust oma SLM-toega MCP rakenduste loomiseks, avades võimalusi automatiseerimiseks, andmetöötluseks ja intelligentsete süsteemide integreerimiseks.

---

**Lahtiütlus**:  
See dokument on tõlgitud AI tõlketeenuse [Co-op Translator](https://github.com/Azure/co-op-translator) abil. Kuigi püüame tagada täpsust, palume arvestada, et automaatsed tõlked võivad sisaldada vigu või ebatäpsusi. Algne dokument selle algses keeles tuleks pidada autoriteetseks allikaks. Olulise teabe puhul soovitame kasutada professionaalset inimtõlget. Me ei vastuta selle tõlke kasutamisest tulenevate arusaamatuste või valesti tõlgenduste eest.