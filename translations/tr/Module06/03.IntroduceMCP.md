<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "b6bd5b920b610665fd0462f6b5c2e134",
  "translation_date": "2025-09-17T23:14:34+00:00",
  "source_file": "Module06/03.IntroduceMCP.md",
  "language_code": "tr"
}
-->
# Bölüm 03 - Model Context Protocol (MCP) Entegrasyonu

## MCP'ye Giriş (Model Context Protocol)

Model Context Protocol (MCP), dil modellerinin harici araçlar ve sistemlerle standart bir şekilde etkileşim kurmasını sağlayan devrim niteliğinde bir çerçevedir. Geleneksel yaklaşımlarda modeller izole çalışırken, MCP, iyi tanımlanmış bir protokol aracılığıyla yapay zeka modelleri ile gerçek dünya arasında bir köprü oluşturur.

### MCP Nedir?

MCP, dil modellerinin aşağıdaki işlemleri gerçekleştirmesine olanak tanıyan bir iletişim protokolü olarak hizmet eder:
- Harici veri kaynaklarına bağlanma
- Araçları ve işlevleri çalıştırma
- API'ler ve hizmetlerle etkileşim kurma
- Gerçek zamanlı bilgilere erişim
- Karmaşık çok adımlı işlemleri gerçekleştirme

Bu protokol, statik dil modellerini metin üretiminin ötesinde pratik görevler gerçekleştirebilen dinamik ajanlara dönüştürür.

## MCP'de Küçük Dil Modelleri (SLM'ler)

Küçük Dil Modelleri, yapay zeka dağıtımında verimli bir yaklaşımı temsil eder ve çeşitli avantajlar sunar:

### SLM'lerin Faydaları
- **Kaynak Verimliliği**: Daha düşük hesaplama gereksinimleri
- **Daha Hızlı Yanıt Süreleri**: Gerçek zamanlı uygulamalar için azaltılmış gecikme  
- **Maliyet Etkinliği**: Minimum altyapı ihtiyaçları
- **Gizlilik**: Veri aktarımı olmadan yerel olarak çalışabilir
- **Özelleştirme**: Belirli alanlar için daha kolay ince ayar yapılabilir

### SLM'lerin MCP ile İyi Çalışmasının Sebebi

SLM'ler MCP ile birleştirildiğinde, modelin akıl yürütme yetenekleri harici araçlarla desteklenir ve daha küçük parametre sayısını artırılmış işlevsellikle telafi eder.

## Python MCP SDK Genel Bakış

Python MCP SDK, MCP özellikli uygulamalar oluşturmak için temel sağlar. SDK şunları içerir:

- **İstemci Kütüphaneleri**: MCP sunucularına bağlanmak için
- **Sunucu Çerçevesi**: Özel MCP sunucuları oluşturmak için
- **Protokol İşleyicileri**: İletişimi yönetmek için
- **Araç Entegrasyonu**: Harici işlevleri çalıştırmak için

## Pratik Uygulama: Phi-4 MCP İstemcisi

Microsoft'un MCP yetenekleriyle entegre edilmiş Phi-4 mini modelini kullanarak gerçek bir uygulamayı inceleyelim.

### Sistem Mimarisi

Uygulama, katmanlı bir mimariyi takip eder:

```
┌─────────────────────────────────────┐
│        Application Layer           │
│  ├── Interactive Loop              │
│  ├── CLI Interface                 │
│  └── Configuration Management      │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│         LLM Client Layer           │
│  ├── OllamaClient                  │
│  ├── VLLMClient                    │
│  └── LLMClient (Abstract)          │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│        MCP Client Layer            │
│  ├── Phi4MiniMCPClient (STDIO)     │
│  ├── Phi4MiniSSEMCPClient (SSE)    │
│  └── BaseMCPClient (Abstract)      │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│      Tool Processing Layer         │
│  ├── ToolCallHandler               │
│  ├── Function Format Transformer   │
│  └── Tool Schema Management        │
└─────────────────────────────────────┘
```

### Temel Bileşenler

#### 1. MCP İstemci Sınıfları

**BaseMCPClient**: Ortak işlevsellik sağlayan soyut temel
- Asenkron bağlam yöneticisi protokolü
- Standart arayüz tanımı
- Kaynak yönetimi

**Phi4MiniMCPClient**: STDIO tabanlı uygulama
- Yerel süreç iletişimi
- Standart giriş/çıkış yönetimi
- Alt süreç yönetimi

**Phi4MiniSSEMCPClient**: Sunucu Gönderimli Olaylar uygulaması
- HTTP akış iletişimi
- Gerçek zamanlı olay yönetimi
- Web tabanlı sunucu bağlantısı

#### 2. LLM Entegrasyonu

**OllamaClient**: Yerel model barındırma
```python
class OllamaClient(LLMClient):
    def __init__(self):
        self.url = "http://localhost:11434/api/chat"
        self.model_id = "phi4-mini:3.8b-fp16"
```

**VLLMClient**: Yüksek performanslı servis
```python
class VLLMClient(LLMClient):
    def __init__(self):
        self.url = "http://localhost:8000/v1"
        self.model_id = "microsoft/Phi-4-mini-instruct"
```

#### 3. Araç İşleme Hattı

Araç işleme hattı, MCP araçlarını dil modelleriyle uyumlu formatlara dönüştürür:

```python
def transform_functions_format(input_data):
    """Convert MCP tool schemas to LLM-compatible formats"""
    # Maps OpenAPI schemas to function calling schemas
    # Handles parameter type conversion
    # Maintains required field information
```

## Başlangıç: Adım Adım Kılavuz

### Adım 1: Ortam Kurulumu

Gerekli bağımlılıkları yükleyin:
```bash
pip install fastmcp mcp-python-client openai requests pyautogui Pillow
```

### Adım 2: Temel Yapılandırma

Ortam değişkenlerinizi ayarlayın:
```python
# System Configuration
SYSTEM_PROMPT = "You are an AI assistant with some tools."

# Ollama Configuration (Local)
OLLAMA_URL = "http://localhost:11434/api/chat"
OLLAMA_MODEL_ID = "phi4-mini:3.8b-fp16"

# vLLM Configuration (Server)
VLLM_URL = "http://localhost:8000/v1"
VLLM_MODEL_ID = "microsoft/Phi-4-mini-instruct"
```

### Adım 3: İlk MCP İstemcinizi Çalıştırma

**Temel Ollama Kurulumu:**
```bash
python ghmodel_mcp_demo.py
```

**vLLM Arka Uç Kullanımı:**
```bash
python ghmodel_mcp_demo.py --env vllm
```

**Sunucu Gönderimli Olaylar Bağlantısı:**
```bash
python ghmodel_mcp_demo.py --run sse
```

**Özel MCP Sunucusu:**
```bash
python ghmodel_mcp_demo.py --server /path/to/server.py
```

### Adım 4: Programatik Kullanım

```python
import asyncio
from ghmodel_mcp_demo import OllamaClient, Phi4MiniMCPClient

async def automated_interaction():
    # Configure MCP server parameters
    server_params = StdioServerParameters(
        command="npx",
        args=["@playwright/mcp@latest"],
        env=None,
    )
    
    # Create MCP client and process tools
    async with Phi4MiniMCPClient(server_params) as mcp_client:
        tools = await process_mcp_tools(mcp_client)
        llm_client = OllamaClient()
        
        # Generate response with tool capabilities
        response, messages = await llm_client.generate_response(
            "Help me automate a web task",
            tools
        )
        return response

# Execute the automation
result = asyncio.run(automated_interaction())
print(result)
```

## Gelişmiş Özellikler

### Çoklu Arka Uç Desteği

Uygulama, Ollama ve vLLM arka uçlarını destekler ve gereksinimlerinize göre seçim yapmanıza olanak tanır:

- **Ollama**: Yerel geliştirme ve test için daha uygun
- **vLLM**: Üretim ve yüksek verim senaryoları için optimize edilmiş

### Esnek Bağlantı Protokolleri

İki bağlantı modu desteklenir:

**STDIO Modu**: Doğrudan süreç iletişimi
- Daha düşük gecikme
- Yerel araçlar için uygun
- Basit kurulum

**SSE Modu**: HTTP tabanlı akış
- Ağ uyumlu
- Dağıtık sistemler için daha iyi
- Gerçek zamanlı güncellemeler

### Araç Entegrasyon Yetenekleri

Sistem çeşitli araçlarla entegre olabilir:
- Web otomasyonu (Playwright)
- Dosya işlemleri
- API etkileşimleri
- Sistem komutları
- Özel işlevler

## Hata Yönetimi ve En İyi Uygulamalar

### Kapsamlı Hata Yönetimi

Uygulama, aşağıdaki durumlar için sağlam hata yönetimi içerir:

**Bağlantı Hataları:**
- MCP sunucu hataları
- Ağ zaman aşımı
- Bağlantı sorunları

**Araç Çalıştırma Hataları:**
- Eksik araçlar
- Parametre doğrulama
- Çalıştırma hataları

**Yanıt İşleme Hataları:**
- JSON ayrıştırma sorunları
- Format tutarsızlıkları
- LLM yanıt anomalileri

### En İyi Uygulamalar

1. **Kaynak Yönetimi**: Asenkron bağlam yöneticileri kullanın
2. **Hata Yönetimi**: Kapsamlı try-catch blokları uygulayın
3. **Günlükleme**: Uygun günlükleme seviyelerini etkinleştirin
4. **Güvenlik**: Girdileri doğrulayın ve çıktıları temizleyin
5. **Performans**: Bağlantı havuzu ve önbellekleme kullanın

## Gerçek Dünya Uygulamaları

### Web Otomasyonu
```python
# Example: Automated web testing
async def web_automation_example():
    tools = await setup_playwright_tools()
    response = await llm_client.generate_response(
        "Navigate to example.com and take a screenshot",
        tools
    )
```

### Veri İşleme
```python
# Example: File analysis
async def data_processing_example():
    tools = await setup_file_tools()
    response = await llm_client.generate_response(
        "Analyze the CSV file and generate a summary report",
        tools
    )
```

### API Entegrasyonu
```python
# Example: API interactions
async def api_integration_example():
    tools = await setup_api_tools()
    response = await llm_client.generate_response(
        "Fetch weather data and create a forecast summary",
        tools
    )
```

## Performans Optimizasyonu

### Bellek Yönetimi
- Verimli mesaj geçmişi yönetimi
- Uygun kaynak temizliği
- Bağlantı havuzu

### Ağ Optimizasyonu
- Asenkron HTTP işlemleri
- Yapılandırılabilir zaman aşımı
- Zarif hata kurtarma

### Eşzamanlı İşleme
- Engellemeyen I/O
- Paralel araç çalıştırma
- Verimli asenkron desenler

## Güvenlik Hususları

### Veri Koruma
- Güvenli API anahtarı yönetimi
- Girdi doğrulama
- Çıktı temizleme

### Ağ Güvenliği
- HTTPS desteği
- Yerel uç nokta varsayılanları
- Güvenli token yönetimi

### Çalıştırma Güvenliği
- Araç filtreleme
- Kumlanmış ortamlar
- Denetim günlükleme

## Sonuç

MCP ile entegre edilmiş SLM'ler, yapay zeka uygulama geliştirmede bir paradigma değişimini temsil eder. Küçük modellerin verimliliğini harici araçların gücüyle birleştirerek, geliştiriciler hem kaynak açısından verimli hem de oldukça yetenekli akıllı sistemler oluşturabilir.

Phi-4 MCP istemcisi uygulaması, bu entegrasyonun pratikte nasıl gerçekleştirilebileceğini gösterir ve sofistike yapay zeka destekli uygulamalar oluşturmak için sağlam bir temel sağlar.

Önemli çıkarımlar:
- MCP, dil modelleri ile harici sistemler arasındaki boşluğu doldurur
- SLM'ler, araçlarla desteklendiğinde yeteneklerden ödün vermeden verimlilik sunar
- Modüler mimari, kolay genişletme ve özelleştirme sağlar
- Üretim kullanımı için uygun hata yönetimi ve güvenlik önlemleri gereklidir

Bu eğitim, kendi SLM destekli MCP uygulamalarınızı oluşturmak için temel sağlar ve otomasyon, veri işleme ve akıllı sistem entegrasyonu için yeni olanaklar sunar.

---

**Feragatname**:  
Bu belge, AI çeviri hizmeti [Co-op Translator](https://github.com/Azure/co-op-translator) kullanılarak çevrilmiştir. Doğruluk için çaba göstersek de, otomatik çevirilerin hata veya yanlışlıklar içerebileceğini lütfen unutmayın. Belgenin orijinal dili, yetkili kaynak olarak kabul edilmelidir. Kritik bilgiler için profesyonel insan çevirisi önerilir. Bu çevirinin kullanımından kaynaklanan yanlış anlamalar veya yanlış yorumlamalar için sorumluluk kabul etmiyoruz.